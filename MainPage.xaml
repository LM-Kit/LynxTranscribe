<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:l="clr-namespace:LynxTranscribe.Localization"
             xmlns:controls="clr-namespace:LynxTranscribe.Controls"
             x:Class="LynxTranscribe.MainPage"
             BackgroundColor="{DynamicResource BackgroundPrimary}"
             Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Premium Dark Theme Colors -->
            <Color x:Key="BackgroundPrimary">#0A0A0B</Color>
            <Color x:Key="BackgroundSecondary">#111113</Color>
            <Color x:Key="BackgroundTertiary">#18181B</Color>

            <Color x:Key="SurfaceColor">#1A1A1E</Color>
            <Color x:Key="SurfaceBorder">#3F3F46</Color>
            <Color x:Key="SurfaceBorderSubtle">#27272A</Color>

            <!-- Accent: Warm Amber -->
            <Color x:Key="AccentPrimary">#F59E0B</Color>
            <Color x:Key="AccentText">#F59E0B</Color>
            <Color x:Key="AccentMuted">#78350F</Color>
            <Color x:Key="AccentSurface">#1C1508</Color>

            <!-- Status -->
            <Color x:Key="SuccessColor">#10B981</Color>
            <Color x:Key="SuccessSurface">#052E1C</Color>
            <Color x:Key="DangerColor">#EF4444</Color>
            <Color x:Key="DangerSurface">#2D1515</Color>

            <!-- Typography -->
            <Color x:Key="TextPrimary">#FAFAFA</Color>
            <Color x:Key="TextSecondary">#D4D4D8</Color>
            <Color x:Key="TextTertiary">#A1A1AA</Color>
            <Color x:Key="TextMuted">#71717A</Color>

            <!-- Overlay -->
            <Color x:Key="DisabledOverlay">#60000000</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" Padding="0">

        <!-- Compact Header Bar -->
        <Border Grid.Row="0" 
                BackgroundColor="{DynamicResource BackgroundSecondary}"
                StrokeThickness="0">
            <Grid Padding="24,16" ColumnDefinitions="Auto,*,Auto,Auto,Auto">

                <!-- App Branding (Icon + Name) - Left side -->
                <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                    <Image Source="lynxtranscribe_logo.png"
                           HeightRequest="48"
                           WidthRequest="48"
                           Aspect="AspectFit"
                           VerticalOptions="Center" />
                    <HorizontalStackLayout Spacing="0" VerticalOptions="Center">
                        <Label Text="Lynx"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource AccentPrimary}"
                               VerticalOptions="Center" />
                        <Label Text="Transcribe"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource TextPrimary}"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>
                </HorizontalStackLayout>

                <!-- Spacer -->
                <ContentView Grid.Column="1" BackgroundColor="Transparent" InputTransparent="True" />

                <!-- Cancel Transcription Button (shown during transcription) -->
                <Border x:Name="HeaderCancelButton"
                        Grid.Column="2"
                        BackgroundColor="{DynamicResource DangerSurface}"
                        Stroke="{DynamicResource DangerColor}"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="1"
                        Padding="16,8"
                        Margin="0,0,12,0"
                        VerticalOptions="Center"
                        IsVisible="False">
                    <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                        <Label x:Name="HeaderCancelIcon" Text="âœ•" FontSize="13" TextColor="{DynamicResource DangerColor}" VerticalOptions="Center" />
                        <Label x:Name="HeaderCancelText" Text="{l:Translate Cancel}" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource DangerColor}" VerticalOptions="Center" />
                    </HorizontalStackLayout>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCancelTranscriptionClicked" />
                        <PointerGestureRecognizer PointerEntered="OnHeaderCancelHoverEnter" PointerExited="OnHeaderCancelHoverExit" />
                    </Border.GestureRecognizers>
                </Border>

                <!-- Keyboard Shortcuts Help Button -->
                <Border x:Name="ShortcutsButtonBorder"
                        Grid.Column="3"
                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                        StrokeShape="RoundRectangle 8"
                        Stroke="{DynamicResource SurfaceBorder}"
                        StrokeThickness="1"
                        HeightRequest="36"
                        WidthRequest="36"
                        Padding="0"
                        Margin="0,0,8,0"
                        ToolTipProperties.Text="{l:Translate KeyboardShortcuts}">
                    <Label x:Name="ShortcutsButtonLabel"
                           Text="?"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{DynamicResource TextSecondary}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnShortcutsButtonClicked" />
                        <PointerGestureRecognizer PointerEntered="OnShortcutsButtonHoverEnter" PointerExited="OnShortcutsButtonHoverExit" />
                    </Border.GestureRecognizers>
                </Border>

                <!-- Settings Button (far right) -->
                <Border x:Name="SettingsButtonBorder"
                        Grid.Column="4"
                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                        StrokeShape="RoundRectangle 8"
                        Stroke="{DynamicResource SurfaceBorder}"
                        StrokeThickness="1"
                        HeightRequest="36"
                        WidthRequest="36"
                        Padding="0"
                        Margin="0"
                        ToolTipProperties.Text="{l:Translate Settings}">
                    <!-- Modern sliders icon (same as Settings panel) -->
                    <Grid HeightRequest="18" WidthRequest="18" 
                          HorizontalOptions="Center" VerticalOptions="Center">
                        <Line x:Name="SettingsLine1" X1="0" Y1="4" X2="18" Y2="4" Stroke="{DynamicResource TextSecondary}" StrokeThickness="2" StrokeLineCap="Round" />
                        <Line x:Name="SettingsLine2" X1="0" Y1="9" X2="18" Y2="9" Stroke="{DynamicResource TextSecondary}" StrokeThickness="2" StrokeLineCap="Round" />
                        <Line x:Name="SettingsLine3" X1="0" Y1="14" X2="18" Y2="14" Stroke="{DynamicResource TextSecondary}" StrokeThickness="2" StrokeLineCap="Round" />
                        <Ellipse x:Name="SettingsDot1" Fill="{DynamicResource TextSecondary}" WidthRequest="5" HeightRequest="5" HorizontalOptions="Start" VerticalOptions="Start" Margin="4,1.5,0,0" />
                        <Ellipse x:Name="SettingsDot2" Fill="{DynamicResource TextSecondary}" WidthRequest="5" HeightRequest="5" HorizontalOptions="Start" VerticalOptions="Start" Margin="10,6.5,0,0" />
                        <Ellipse x:Name="SettingsDot3" Fill="{DynamicResource TextSecondary}" WidthRequest="5" HeightRequest="5" HorizontalOptions="Start" VerticalOptions="Start" Margin="6,11.5,0,0" />
                    </Grid>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnSettingsClicked" />
                        <PointerGestureRecognizer PointerEntered="OnSettingsButtonHoverEnter" PointerExited="OnSettingsButtonHoverExit" />
                    </Border.GestureRecognizers>
                </Border>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,Auto,*" Padding="24,20,24,8">

            <!-- Left Panel: Tabbed File/History -->
            <Border x:Name="LeftPanel"
                    BackgroundColor="{DynamicResource SurfaceColor}"
                    StrokeShape="RoundRectangle 12"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    WidthRequest="340"
                    Margin="0,0,0,12">
                <Border.Shadow>
                    <Shadow Brush="#000000" Offset="2,2" Radius="8" Opacity="0.08" />
                </Border.Shadow>
                <Grid>
                    <!-- Main Content -->
                    <Grid RowDefinitions="Auto,*">
                    
                    <!-- Tab Headers -->
                    <Grid x:Name="TabHeaderGrid" ColumnDefinitions="*,*,Auto" Padding="8,8,8,0">
                        <Border x:Name="FileTabButton"
                                BackgroundColor="{DynamicResource AccentSurface}"
                                StrokeShape="RoundRectangle 6"
                                Stroke="{DynamicResource AccentMuted}"
                                StrokeThickness="1"
                                Padding="10,8"
                                Margin="0,0,4,0">
                            <HorizontalStackLayout Spacing="4" HorizontalOptions="Center">
                                <Label Text="â—‰" FontSize="13" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                <Label x:Name="FileTabLabel"
                                       Text="Audio"
                                       FontSize="13"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource AccentText}"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnFileTabClicked" />
                                <PointerGestureRecognizer PointerEntered="OnFileTabHoverEnter" PointerExited="OnFileTabHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border x:Name="HistoryTabButton"
                                Grid.Column="1"
                                BackgroundColor="Transparent"
                                StrokeShape="RoundRectangle 6"
                                Stroke="Transparent"
                                StrokeThickness="1"
                                Padding="10,8"
                                Margin="4,0,0,0">
                            <HorizontalStackLayout Spacing="4" HorizontalOptions="Center">
                                <Label Text="â˜°" FontSize="13" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                <Label x:Name="HistoryTabLabel"
                                       Text="History"
                                       FontSize="13"
                                       TextColor="{DynamicResource TextPrimary}"
                                       VerticalOptions="Center" />
                                <Border x:Name="HistoryCountBadge"
                                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                                        StrokeShape="RoundRectangle 8"
                                        StrokeThickness="0"
                                        Padding="5,2"
                                        IsVisible="False">
                                    <Label x:Name="HistoryCountLabel"
                                           Text="0"
                                           FontSize="11"
                                           TextColor="{DynamicResource TextPrimary}"
                                           VerticalOptions="Center" />
                                </Border>
                            </HorizontalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnHistoryTabClicked" />
                                <PointerGestureRecognizer PointerEntered="OnHistoryTabHoverEnter" PointerExited="OnHistoryTabHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                        
                        <!-- Collapse Button -->
                        <Border x:Name="CollapseButton"
                                Grid.Column="2"
                                BackgroundColor="Transparent"
                                StrokeShape="RoundRectangle 4"
                                Stroke="Transparent"
                                StrokeThickness="0"
                                Padding="6,8"
                                Margin="4,0,0,0"
                                VerticalOptions="Center">
                            <Label x:Name="CollapseButtonLabel"
                                   Text="Â«" 
                                   FontSize="15" 
                                   TextColor="{DynamicResource TextPrimary}" 
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center" />
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnCollapseButtonClicked" />
                                <PointerGestureRecognizer PointerEntered="OnCollapseButtonHoverEnter" PointerExited="OnCollapseButtonHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                    </Grid>

                    <!-- Tab Content -->
                    <Grid Grid.Row="1" Padding="12">
                        
                        <!-- FILE TAB CONTENT -->
                        <Grid x:Name="FileTabContent" RowDefinitions="*,Auto,Auto">
                            <!-- Drop Zone / File Info -->
                            <Border x:Name="DropZone"
                                    BackgroundColor="{DynamicResource BackgroundSecondary}"
                                    StrokeShape="RoundRectangle 10"
                                    Stroke="{DynamicResource SurfaceBorder}"
                                    StrokeThickness="1.5"
                                    StrokeDashArray="6,4"
                                    Padding="16">
                                <Border.GestureRecognizers>
                                    <DropGestureRecognizer AllowDrop="True"
                                                           DragOver="OnDragOver"
                                                           DragLeave="OnDragLeave"
                                                           Drop="OnDrop" />
                                    <TapGestureRecognizer Tapped="OnSelectFileClicked" />
                                </Border.GestureRecognizers>
                                <Grid RowDefinitions="*" VerticalOptions="Fill">
                                    <!-- Empty state -->
                                    <VerticalStackLayout x:Name="EmptyState"
                                                         Spacing="12" 
                                                         VerticalOptions="Center" 
                                                         HorizontalOptions="Center">
                                        <Border x:Name="WaveformIcon"
                                                BackgroundColor="{DynamicResource AccentSurface}"
                                                StrokeShape="RoundRectangle 12"
                                                Stroke="{DynamicResource AccentMuted}"
                                                StrokeThickness="1.5"
                                                StrokeDashArray="4,3"
                                                HeightRequest="56"
                                                WidthRequest="56"
                                                HorizontalOptions="Center">
                                            <!-- Audio waveform icon with animated bars -->
                                            <Grid HorizontalOptions="Center" VerticalOptions="Center" WidthRequest="28" HeightRequest="24">
                                                <BoxView x:Name="WaveBar1" Color="{DynamicResource AccentText}" CornerRadius="1.5" WidthRequest="3" HeightRequest="8" HorizontalOptions="Start" VerticalOptions="Center" Margin="0,0,0,0" />
                                                <BoxView x:Name="WaveBar2" Color="{DynamicResource AccentText}" CornerRadius="1.5" WidthRequest="3" HeightRequest="16" HorizontalOptions="Start" VerticalOptions="Center" Margin="5,0,0,0" />
                                                <BoxView x:Name="WaveBar3" Color="{DynamicResource AccentText}" CornerRadius="1.5" WidthRequest="3" HeightRequest="24" HorizontalOptions="Start" VerticalOptions="Center" Margin="10,0,0,0" />
                                                <BoxView x:Name="WaveBar4" Color="{DynamicResource AccentText}" CornerRadius="1.5" WidthRequest="3" HeightRequest="14" HorizontalOptions="Start" VerticalOptions="Center" Margin="15,0,0,0" />
                                                <BoxView x:Name="WaveBar5" Color="{DynamicResource AccentText}" CornerRadius="1.5" WidthRequest="3" HeightRequest="20" HorizontalOptions="Start" VerticalOptions="Center" Margin="20,0,0,0" />
                                                <BoxView x:Name="WaveBar6" Color="{DynamicResource AccentText}" CornerRadius="1.5" WidthRequest="3" HeightRequest="10" HorizontalOptions="Start" VerticalOptions="Center" Margin="25,0,0,0" />
                                            </Grid>
                                        </Border>
                                        <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                            <Label x:Name="DropZoneTitle"
                                                   Text="Drop audio file here" 
                                                   FontSize="13"
                                                   FontAttributes="Bold"
                                                   TextColor="{DynamicResource TextPrimary}"
                                                   HorizontalOptions="Center" />
                                            <Label x:Name="DropZoneSubtitle"
                                                   Text="or browse files / record audio" 
                                                   FontSize="12"
                                                   TextColor="{DynamicResource TextTertiary}"
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                    </VerticalStackLayout>

                                    <!-- File selected state -->
                                    <VerticalStackLayout x:Name="FileSelectedState"
                                                         IsVisible="False"
                                                         Spacing="10"
                                                         VerticalOptions="Center">
                                        <Border BackgroundColor="{DynamicResource AccentSurface}"
                                                StrokeShape="RoundRectangle 8"
                                                Stroke="{DynamicResource AccentMuted}"
                                                StrokeThickness="1"
                                                HeightRequest="44"
                                                WidthRequest="44"
                                                HorizontalOptions="Center">
                                            <Label Text="â™ª" FontSize="18" TextColor="{DynamicResource AccentText}" HorizontalOptions="Center" VerticalOptions="Center" />
                                        </Border>
                                        <Label x:Name="SelectedFileName" 
                                               Text="filename.wav"
                                               FontSize="12"
                                               FontAttributes="Bold"
                                               TextColor="{DynamicResource TextPrimary}"
                                               HorizontalOptions="Center"
                                               LineBreakMode="TailTruncation"
                                               MaxLines="2"
                                               HorizontalTextAlignment="Center" />
                                        <Label x:Name="SelectedFileInfo" 
                                               Text="2.4 MB Â· 3:24"
                                               FontSize="11"
                                               TextColor="{DynamicResource TextTertiary}"
                                               HorizontalOptions="Center" />
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>

                            <!-- Audio Player Controls -->
                            <Border x:Name="PlayerPanel"
                                    Grid.Row="1"
                                    BackgroundColor="{DynamicResource BackgroundSecondary}"
                                    StrokeShape="RoundRectangle 8"
                                    Stroke="{DynamicResource SurfaceBorder}"
                                    StrokeThickness="1"
                                    Padding="12,10"
                                    Margin="0,10,0,0"
                                    IsVisible="False">
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                                    <!-- Play/Pause and Speed Controls Row -->
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <!-- Play Controls -->
                                        <HorizontalStackLayout Spacing="6">
                                            <!-- Play/Pause Button -->
                                            <Border x:Name="PlayPauseButton"
                                                    BackgroundColor="{DynamicResource AccentPrimary}"
                                                    StrokeShape="RoundRectangle 6"
                                                    Stroke="Transparent"
                                                    StrokeThickness="0"
                                                    HeightRequest="36"
                                                    WidthRequest="36"
                                                    HorizontalOptions="Start">
                                                <Label x:Name="PlayPauseIcon" 
                                                       Text="â–¶" 
                                                       FontSize="14" 
                                                       TextColor="White" 
                                                       HorizontalOptions="Center" 
                                                       VerticalOptions="Center" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnPlayPauseClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnPlayPauseHoverEnter" PointerExited="OnPlayPauseHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <!-- Restart Button -->
                                            <Border x:Name="RestartButton"
                                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                    StrokeShape="RoundRectangle 6"
                                                    Stroke="{DynamicResource SurfaceBorder}"
                                                    StrokeThickness="1"
                                                    HeightRequest="36"
                                                    WidthRequest="36"
                                                    HorizontalOptions="Start"
                                                    ToolTipProperties.Text="Restart from beginning">
                                                <Label x:Name="RestartIcon" 
                                                       Text="âŸ²" 
                                                       FontSize="16" 
                                                       TextColor="{DynamicResource TextSecondary}" 
                                                       HorizontalOptions="Center" 
                                                       VerticalOptions="Center" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnRestartClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnRestartHoverEnter" PointerExited="OnRestartHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                        </HorizontalStackLayout>

                                        <!-- Speed Controls -->
                                        <HorizontalStackLayout Grid.Column="2" Spacing="4" VerticalOptions="Center">
                                            <Border x:Name="Speed05Button"
                                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                    StrokeShape="RoundRectangle 4"
                                                    Stroke="{DynamicResource SurfaceBorder}"
                                                    StrokeThickness="1"
                                                    Padding="6,3"
                                                    HeightRequest="24">
                                                <Label x:Name="Speed05Label" Text="0.5x" FontSize="9" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" VerticalOptions="Center" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnSpeed05Clicked" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Border x:Name="Speed1Button"
                                                    BackgroundColor="{DynamicResource AccentSurface}"
                                                    StrokeShape="RoundRectangle 4"
                                                    Stroke="{DynamicResource AccentMuted}"
                                                    StrokeThickness="1"
                                                    Padding="6,3"
                                                    HeightRequest="24">
                                                <Label x:Name="Speed1Label" Text="1x" FontSize="9" TextColor="{DynamicResource AccentText}" HorizontalOptions="Center" VerticalOptions="Center" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnSpeed1Clicked" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Border x:Name="Speed15Button"
                                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                    StrokeShape="RoundRectangle 4"
                                                    Stroke="{DynamicResource SurfaceBorder}"
                                                    StrokeThickness="1"
                                                    Padding="6,3"
                                                    HeightRequest="24">
                                                <Label x:Name="Speed15Label" Text="1.5x" FontSize="9" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" VerticalOptions="Center" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnSpeed15Clicked" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Border x:Name="Speed2Button"
                                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                    StrokeShape="RoundRectangle 4"
                                                    Stroke="{DynamicResource SurfaceBorder}"
                                                    StrokeThickness="1"
                                                    Padding="6,3"
                                                    HeightRequest="24">
                                                <Label x:Name="Speed2Label" Text="2x" FontSize="9" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" VerticalOptions="Center" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnSpeed2Clicked" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                        </HorizontalStackLayout>
                                    </Grid>

                                    <!-- Waveform Visualization -->
                                    <GraphicsView x:Name="WaveformView"
                                                  Grid.Row="1"
                                                  HeightRequest="48"
                                                  Margin="0,8,0,0"
                                                  BackgroundColor="Transparent">
                                        <GraphicsView.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnWaveformTapped" />
                                            <PanGestureRecognizer PanUpdated="OnWaveformPanUpdated" />
                                        </GraphicsView.GestureRecognizers>
                                    </GraphicsView>

                                    <!-- Hidden Slider for value tracking -->
                                    <Slider x:Name="PlaybackSlider"
                                            Grid.Row="2"
                                            Minimum="0"
                                            Maximum="100"
                                            Value="0"
                                            IsVisible="False"
                                            ValueChanged="OnPlaybackSliderChanged"
                                            DragStarted="OnPlaybackSliderDragStarted"
                                            DragCompleted="OnPlaybackSliderDragCompleted" />

                                    <!-- Time and Volume Row -->
                                    <Grid Grid.Row="3" ColumnDefinitions="Auto,*,Auto,Auto" Margin="0,4,0,0">
                                        <HorizontalStackLayout Spacing="4" VerticalOptions="Center">
                                            <Label x:Name="CurrentTimeLabel" Text="0:00" FontSize="10" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Label Text="/" FontSize="10" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" />
                                            <Label x:Name="TotalTimeLabel" Text="0:00" FontSize="10" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                        </HorizontalStackLayout>
                                        
                                        <ContentView Grid.Column="1" BackgroundColor="Transparent" InputTransparent="True" />
                                        
                                        <Label Grid.Column="2" Text="ðŸ”Š" FontSize="10" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" Margin="0,0,4,0" />
                                        <Slider x:Name="VolumeSlider"
                                                Grid.Column="3"
                                                Minimum="0"
                                                Maximum="1"
                                                Value="0.8"
                                                MinimumTrackColor="{DynamicResource AccentPrimary}"
                                                MaximumTrackColor="{DynamicResource SurfaceBorder}"
                                                ThumbColor="{DynamicResource AccentPrimary}"
                                                WidthRequest="60"
                                                VerticalOptions="Center"
                                                ValueChanged="OnVolumeChanged" />
                                    </Grid>
                                </Grid>
                            </Border>

                            <!-- Action Buttons -->
                            <HorizontalStackLayout Grid.Row="2" Spacing="10" Margin="0,12,0,0">
                                <!-- Primary Button: Browse -->
                                <Border x:Name="BrowseButton"
                                        BackgroundColor="{DynamicResource AccentPrimary}"
                                        Stroke="Transparent"
                                        StrokeShape="RoundRectangle 8"
                                        StrokeThickness="0"
                                        Padding="16,0"
                                        HeightRequest="38">
                                    <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                        <Label Text="+" FontSize="18" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" Margin="0,-2,0,0" />
                                        <Label x:Name="BrowseButtonLabel" Text="Browse" FontSize="13" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" />
                                    </HorizontalStackLayout>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnSelectFileClicked" />
                                        <PointerGestureRecognizer PointerEntered="OnBrowseHoverEnter" PointerExited="OnBrowseHoverExit" />
                                    </Border.GestureRecognizers>
                                </Border>
                                
                                <!-- Secondary Button: Record -->
                                <Border x:Name="RecordButton"
                                        BackgroundColor="Transparent"
                                        Stroke="{DynamicResource SurfaceBorder}"
                                        StrokeShape="RoundRectangle 8"
                                        StrokeThickness="1.5"
                                        Padding="14,0"
                                        HeightRequest="38">
                                    <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                        <Ellipse Fill="#EF4444" WidthRequest="10" HeightRequest="10" VerticalOptions="Center" />
                                        <Label x:Name="RecordButtonLabel" Text="Record" FontSize="13" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                    </HorizontalStackLayout>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnRecordClicked" />
                                        <PointerGestureRecognizer PointerEntered="OnRecordHoverEnter" PointerExited="OnRecordHoverExit" />
                                    </Border.GestureRecognizers>
                                </Border>
                                
                                <!-- Ghost Button: Clear -->
                                <Border x:Name="ClearButton"
                                        BackgroundColor="Transparent"
                                        Stroke="Transparent"
                                        StrokeShape="RoundRectangle 8"
                                        StrokeThickness="0"
                                        Padding="12,0"
                                        HeightRequest="38"
                                        IsVisible="False">
                                    <Label x:Name="ClearButtonLabel" Text="Clear" FontSize="13" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" />
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnClearFileClicked" />
                                        <PointerGestureRecognizer PointerEntered="OnClearHoverEnter" PointerExited="OnClearHoverExit" />
                                    </Border.GestureRecognizers>
                                </Border>
                            </HorizontalStackLayout>
                            
                            <!-- Recording State (overlays on drop zone when recording) -->
                            <Border x:Name="RecordingPanel"
                                    Grid.Row="1"
                                    BackgroundColor="{DynamicResource BackgroundSecondary}"
                                    StrokeShape="RoundRectangle 12"
                                    Stroke="#EF4444"
                                    StrokeThickness="2"
                                    StrokeDashArray="6,4"
                                    Padding="24"
                                    IsVisible="False">
                                <VerticalStackLayout Spacing="16" VerticalOptions="Center" HorizontalOptions="Center">
                                    <!-- Countdown display (shown before recording) -->
                                    <VerticalStackLayout x:Name="CountdownPanel" Spacing="8" HorizontalOptions="Center" IsVisible="False"
                                                         ToolTipProperties.Text="Click to skip countdown">
                                        <Label x:Name="GetReadyLabel"
                                               Text="Get ready..." 
                                               FontSize="14" 
                                               TextColor="{DynamicResource TextSecondary}" 
                                               HorizontalOptions="Center" />
                                        <Label x:Name="CountdownLabel" 
                                               Text="3" 
                                               FontSize="48" 
                                               FontAttributes="Bold" 
                                               TextColor="#EF4444" 
                                               HorizontalOptions="Center" />
                                        <Label x:Name="ClickToSkipLabel"
                                               Text="Click to skip" 
                                               FontSize="10" 
                                               TextColor="{DynamicResource TextMuted}" 
                                               HorizontalOptions="Center" />
                                        <VerticalStackLayout.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnCountdownSkipClicked" />
                                        </VerticalStackLayout.GestureRecognizers>
                                    </VerticalStackLayout>
                                    
                                    <!-- Recording display (shown while recording) -->
                                    <VerticalStackLayout x:Name="RecordingActivePanel" Spacing="16" HorizontalOptions="Center" IsVisible="False">
                                        <HorizontalStackLayout Spacing="12" HorizontalOptions="Center">
                                            <Ellipse x:Name="RecordingDot" Fill="#EF4444" WidthRequest="14" HeightRequest="14" VerticalOptions="Center" />
                                            <Label x:Name="RecordingLabel" Text="Recording..." FontSize="16" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Label x:Name="RecordingDuration" Text="00:00" FontSize="16" FontAttributes="Bold" TextColor="#EF4444" VerticalOptions="Center" />
                                        </HorizontalStackLayout>
                                        
                                        <!-- Audio Level Bar -->
                                        <Grid WidthRequest="200" HeightRequest="8" HorizontalOptions="Center">
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" 
                                                    StrokeShape="RoundRectangle 4" 
                                                    Stroke="Transparent" />
                                            <Border x:Name="AudioLevelBar"
                                                    BackgroundColor="#EF4444"
                                                    StrokeShape="RoundRectangle 4"
                                                    Stroke="Transparent"
                                                    HorizontalOptions="Start"
                                                    WidthRequest="0" />
                                        </Grid>
                                        
                                        <Border x:Name="StopRecordingButton"
                                                BackgroundColor="#EF4444"
                                                Stroke="Transparent"
                                                StrokeShape="RoundRectangle 8"
                                                StrokeThickness="0"
                                                Padding="18,0"
                                                HeightRequest="38"
                                                HorizontalOptions="Center"
                                                Margin="0,8,0,0">
                                            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                                <Border BackgroundColor="White" 
                                                        StrokeShape="RoundRectangle 2" 
                                                        Stroke="Transparent"
                                                        WidthRequest="10" 
                                                        HeightRequest="10" 
                                                        VerticalOptions="Center" />
                                                <Label x:Name="StopRecordingLabel" Text="Stop Recording" FontSize="13" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" />
                                            </HorizontalStackLayout>
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnStopRecordingClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnStopRecordingHoverEnter" PointerExited="OnStopRecordingHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                        
                                        <Label x:Name="RecordingInputLabel" 
                                               Text="Using: Default Microphone" 
                                               FontSize="11" 
                                               TextColor="{DynamicResource TextMuted}" 
                                               HorizontalOptions="Center" />
                                    </VerticalStackLayout>
                                </VerticalStackLayout>
                            </Border>
                        </Grid>

                        <!-- HISTORY TAB CONTENT -->
                        <Grid x:Name="HistoryTabContent" 
                              IsVisible="False"
                              RowDefinitions="Auto,*,Auto">
                            
                            <!-- Search Box -->
                            <Border BackgroundColor="{DynamicResource BackgroundSecondary}"
                                    StrokeShape="RoundRectangle 8"
                                    Stroke="{DynamicResource SurfaceBorder}"
                                    StrokeThickness="1"
                                    Padding="12,8"
                                    Margin="0,0,0,12">
                                <Grid ColumnDefinitions="Auto,*">
                                    <!-- Modern search icon -->
                                    <Grid HeightRequest="14" WidthRequest="14" VerticalOptions="Center" Margin="0,0,8,0">
                                        <Ellipse Stroke="{DynamicResource TextMuted}" StrokeThickness="1.5" 
                                                 WidthRequest="10" HeightRequest="10"
                                                 HorizontalOptions="Start" VerticalOptions="Start" />
                                        <Line X1="9" Y1="9" X2="13" Y2="13" 
                                              Stroke="{DynamicResource TextMuted}" StrokeThickness="1.5" StrokeLineCap="Round" />
                                    </Grid>
                                    <Entry x:Name="HistorySearchEntry"
                                           Grid.Column="1"
                                           Placeholder="Search history..."
                                           PlaceholderColor="{DynamicResource TextMuted}"
                                           TextColor="{DynamicResource TextPrimary}"
                                           BackgroundColor="Transparent"
                                           FontSize="13"
                                           TextChanged="OnHistorySearchChanged" />
                                </Grid>
                            </Border>

                            <!-- History List -->
                            <ScrollView x:Name="HistoryScrollView" Grid.Row="1">
                                <VerticalStackLayout x:Name="HistoryList" Spacing="8">
                                    <VerticalStackLayout x:Name="EmptyHistoryState"
                                                         Spacing="12"
                                                         VerticalOptions="Center"
                                                         HorizontalOptions="Center"
                                                         Margin="0,40,0,0">
                                        <Label Text="ðŸ“­" FontSize="32" HorizontalOptions="Center" />
                                        <Label x:Name="NoHistoryTitle"
                                               Text="No history yet"
                                               FontSize="13"
                                               FontAttributes="Bold"
                                               TextColor="{DynamicResource TextSecondary}"
                                               HorizontalOptions="Center" />
                                        <Label x:Name="NoHistorySubtitle"
                                               Text="Transcriptions will appear here"
                                               FontSize="12"
                                               TextColor="{DynamicResource TextMuted}"
                                               HorizontalOptions="Center" />
                                    </VerticalStackLayout>
                                </VerticalStackLayout>
                            </ScrollView>

                            <!-- Clear All Button -->
                            <Border x:Name="ClearHistoryButton"
                                    Grid.Row="2"
                                    BackgroundColor="Transparent"
                                    Stroke="Transparent"
                                    StrokeShape="RoundRectangle 6"
                                    StrokeThickness="1"
                                    Padding="0,6"
                                    Margin="0,8,0,0"
                                    IsVisible="False">
                                <HorizontalStackLayout Spacing="6" HorizontalOptions="Center">
                                    <!-- Simple trash icon -->
                                    <Grid HeightRequest="12" WidthRequest="10" VerticalOptions="Center">
                                        <Line X1="0" Y1="0" X2="10" Y2="0" Stroke="{DynamicResource TextSecondary}" StrokeThickness="1.5" StrokeLineCap="Round" />
                                        <BoxView Color="{DynamicResource TextSecondary}" CornerRadius="1" WidthRequest="8" HeightRequest="9" HorizontalOptions="Center" VerticalOptions="End" />
                                    </Grid>
                                    <Label x:Name="ClearAllLabel" Text="Clear All" FontSize="11" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnClearHistoryClicked" />
                                    <PointerGestureRecognizer PointerEntered="OnClearHistoryHoverEnter" PointerExited="OnClearHistoryHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>
                        </Grid>
                    </Grid>
                </Grid>
                    
                    <!-- Disabled Overlay (shown during transcription) -->
                    <Border x:Name="LeftPanelDisabledOverlay"
                            BackgroundColor="{DynamicResource DisabledOverlay}"
                            StrokeShape="RoundRectangle 12"
                            StrokeThickness="0"
                            IsVisible="False"
                            InputTransparent="False">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer />
                        </Grid.GestureRecognizers>
                    </Border>
                </Grid>
            </Border>

            <!-- Splitter/Resize Handle -->
            <Grid x:Name="Splitter"
                  Grid.Column="1"
                  BackgroundColor="Transparent"
                  WidthRequest="16"
                  Margin="-4,0,-4,0">
                <VerticalStackLayout x:Name="SplitterDots" 
                                     VerticalOptions="Center" 
                                     HorizontalOptions="Center"
                                     Spacing="4"
                                     Opacity="0.6">
                    <Ellipse Fill="{DynamicResource TextTertiary}" WidthRequest="4" HeightRequest="4" />
                    <Ellipse Fill="{DynamicResource TextTertiary}" WidthRequest="4" HeightRequest="4" />
                    <Ellipse Fill="{DynamicResource TextTertiary}" WidthRequest="4" HeightRequest="4" />
                </VerticalStackLayout>
                <Grid.GestureRecognizers>
                    <PanGestureRecognizer PanUpdated="OnSplitterPanUpdated" />
                    <PointerGestureRecognizer PointerEntered="OnSplitterHoverEnter" PointerExited="OnSplitterHoverExit" />
                </Grid.GestureRecognizers>
            </Grid>
            
            <!-- Expand Button (visible when left panel is collapsed) -->
            <Border x:Name="ExpandButton"
                    Grid.Column="0"
                    BackgroundColor="{DynamicResource SurfaceColor}"
                    StrokeShape="RoundRectangle 8"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    WidthRequest="32"
                    HeightRequest="32"
                    HorizontalOptions="Start"
                    VerticalOptions="Start"
                    Margin="0,0,8,0"
                    IsVisible="False">
                <Border.Shadow>
                    <Shadow Brush="#000000" Offset="1,1" Radius="4" Opacity="0.1" />
                </Border.Shadow>
                <Label Text="Â»" 
                       FontSize="16" 
                       TextColor="{DynamicResource TextSecondary}" 
                       VerticalOptions="Center"
                       HorizontalOptions="Center" />
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnExpandButtonClicked" />
                    <PointerGestureRecognizer PointerEntered="OnExpandButtonHoverEnter" PointerExited="OnExpandButtonHoverExit" />
                </Border.GestureRecognizers>
            </Border>

            <!-- Right Panel: Transcript Area -->
            <Border Grid.Column="2"
                    BackgroundColor="{DynamicResource SurfaceColor}"
                    StrokeShape="RoundRectangle 12"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    MinimumWidthRequest="400"
                    Padding="0"
                    Margin="0,0,0,12">
                <Border.Shadow>
                    <Shadow Brush="#000000" Offset="2,2" Radius="8" Opacity="0.08" />
                </Border.Shadow>
                <Grid RowDefinitions="Auto,*,Auto,Auto,Auto,Auto">

                    <!-- Header with stats -->
                    <Grid ColumnDefinitions="Auto,Auto,*,Auto" Padding="24,20,24,0">
                        <Label x:Name="TranscriptHeaderLabel"
                               Text="Transcript" 
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource TextPrimary}"
                               VerticalOptions="Center"
                               IsVisible="False" />

                        <!-- View Mode Toggle - Compact pill design -->
                        <Border x:Name="ViewModeToggle"
                                Grid.Column="1"
                                BackgroundColor="{DynamicResource SurfaceColor}"
                                StrokeShape="RoundRectangle 14"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeThickness="1"
                                Padding="3"
                                Margin="12,0,0,0"
                                VerticalOptions="Center"
                                HeightRequest="28"
                                IsVisible="False">
                            <HorizontalStackLayout Spacing="2">
                                <!-- Segments Tab -->
                                <Border x:Name="ViewModeSegments"
                                        BackgroundColor="{DynamicResource AccentPrimary}"
                                        StrokeShape="RoundRectangle 11"
                                        Stroke="Transparent"
                                        StrokeThickness="0"
                                        Padding="10,2"
                                        HeightRequest="20">
                                    <Label x:Name="ViewModeSegmentsLabel" 
                                           Text="Segments" 
                                           FontSize="11" 
                                           FontAttributes="Bold" 
                                           TextColor="#1C1508" 
                                           VerticalOptions="Center" />
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnViewModeSegmentsClicked" />
                                        <PointerGestureRecognizer PointerEntered="OnViewModeSegmentsHoverEnter" PointerExited="OnViewModeSegmentsHoverExit" />
                                    </Border.GestureRecognizers>
                                </Border>
                                <!-- Document Tab -->
                                <Border x:Name="ViewModeDocument"
                                        BackgroundColor="Transparent"
                                        StrokeShape="RoundRectangle 11"
                                        Stroke="Transparent"
                                        StrokeThickness="0"
                                        Padding="10,2"
                                        HeightRequest="20">
                                    <Label x:Name="ViewModeDocumentLabel" 
                                           Text="Document" 
                                           FontSize="11" 
                                           TextColor="{DynamicResource TextSecondary}" 
                                           VerticalOptions="Center" />
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnViewModeDocumentClicked" />
                                        <PointerGestureRecognizer PointerEntered="OnViewModeDocumentHoverEnter" PointerExited="OnViewModeDocumentHoverExit" />
                                    </Border.GestureRecognizers>
                                </Border>
                            </HorizontalStackLayout>
                        </Border>

                        <!-- Right side toolbar -->
                        <HorizontalStackLayout Grid.Column="3" Spacing="6" VerticalOptions="Center">
                            <!-- Search Button -->
                            <Border x:Name="SearchButton"
                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                    StrokeShape="RoundRectangle 4"
                                    Stroke="{DynamicResource SurfaceBorder}"
                                    StrokeThickness="1"
                                    Padding="10,4"
                                    VerticalOptions="Center"
                                    HeightRequest="26"
                                    IsVisible="False"
                                    ToolTipProperties.Text="Search in transcript (Ctrl+F)">
                                <Label x:Name="SearchButtonLabel"
                                       Text="Search"
                                       FontSize="11"
                                       TextColor="{DynamicResource TextPrimary}"
                                       VerticalOptions="Center"
                                       InputTransparent="True" />
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnSearchButtonClicked" />
                                    <PointerGestureRecognizer PointerEntered="OnSearchButtonHoverEnter" PointerExited="OnSearchButtonHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Edit Toggle -->
                            <Border x:Name="EditToggle"
                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                    StrokeShape="RoundRectangle 4"
                                    Stroke="{DynamicResource SurfaceBorder}"
                                    StrokeThickness="1"
                                    Padding="10,4"
                                    VerticalOptions="Center"
                                    HeightRequest="26"
                                    IsVisible="False">
                                <Label x:Name="EditToggleLabel"
                                       Text="Edit"
                                       FontSize="11"
                                       TextColor="{DynamicResource TextPrimary}"
                                       VerticalOptions="Center"
                                       InputTransparent="True" />
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnEditToggleClicked" />
                                    <PointerGestureRecognizer PointerEntered="OnEditToggleHoverEnter" PointerExited="OnEditToggleHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Dictation Toggle with Help Button -->
                            <HorizontalStackLayout x:Name="DictationGroup" Spacing="2" IsVisible="False">
                                <Border x:Name="DictationToggle"
                                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                                        StrokeShape="RoundRectangle 4,0,0,4"
                                        Stroke="{DynamicResource SurfaceBorder}"
                                        StrokeThickness="1"
                                        Padding="10,4"
                                        VerticalOptions="Center"
                                        HeightRequest="26">
                                    <Label x:Name="DictationToggleLabel"
                                           Text="Dictation"
                                           FontSize="11"
                                           TextColor="{DynamicResource TextPrimary}"
                                           VerticalOptions="Center"
                                           InputTransparent="True" />
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnDictationToggleClicked" />
                                        <PointerGestureRecognizer PointerEntered="OnDictationToggleHoverEnter" PointerExited="OnDictationToggleHoverExit" />
                                    </Border.GestureRecognizers>
                                </Border>
                                <Border x:Name="DictationHelpToolbarButton"
                                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                                        StrokeShape="RoundRectangle 0,4,4,0"
                                        Stroke="{DynamicResource SurfaceBorder}"
                                        StrokeThickness="1"
                                        Padding="6,4"
                                        Margin="-1,0,0,0"
                                        VerticalOptions="Center"
                                        HeightRequest="26"
                                        ToolTipProperties.Text="Show dictation commands">
                                    <Label x:Name="DictationHelpToolbarButtonLabel"
                                           Text="?"
                                           FontSize="11"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource TextTertiary}"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           InputTransparent="True" />
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnDictationHelpClicked" />
                                        <PointerGestureRecognizer PointerEntered="OnDictationHelpToolbarHoverEnter" PointerExited="OnDictationHelpToolbarHoverExit" />
                                    </Border.GestureRecognizers>
                                </Border>
                            </HorizontalStackLayout>

                            <!-- Stats -->
                            <HorizontalStackLayout x:Name="StatsPanel"
                                                   Spacing="6"
                                                   VerticalOptions="Center"
                                                   Margin="6,0,0,0"
                                                   IsVisible="False">
                                <Label x:Name="WordCountLabel" Text="275 words" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                <Label Text="Â·" FontSize="12" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" />
                                <Label x:Name="SegmentCountLabel" Text="12 segments" FontSize="12" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" />
                                <Label x:Name="SegmentCountSeparator" Text="Â·" FontSize="12" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" />
                                <Label x:Name="ProcessingTimeLabel" Text="12.3s" FontSize="12" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" />
                                <Label x:Name="ProcessingTimeSeparator" Text="Â·" FontSize="12" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" />
                                <Border x:Name="ModelModeBadge" 
                                        BackgroundColor="#1a2563eb" 
                                        StrokeShape="RoundRectangle 4" 
                                        Stroke="Transparent" 
                                        Padding="6,2">
                                    <Label x:Name="ModelModeLabel" Text="Accurate" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                </Border>
                                <Border x:Name="VadBadge" 
                                        BackgroundColor="#1a22c55e" 
                                        StrokeShape="RoundRectangle 4" 
                                        Stroke="Transparent" 
                                        Padding="6,2"
                                        IsVisible="False"
                                        ToolTipProperties.Text="Voice Activity Detection was enabled - silence and non-speech audio were filtered out">
                                    <Label x:Name="VadLabel" Text="VAD" FontSize="10" FontAttributes="Bold" TextColor="#22c55e" VerticalOptions="Center" />
                                </Border>
                                <Border x:Name="LanguageBadge" 
                                        BackgroundColor="#1a8b5cf6" 
                                        StrokeShape="RoundRectangle 4" 
                                        Stroke="Transparent" 
                                        Padding="6,2"
                                        IsVisible="False">
                                    <Label x:Name="LanguageNameLabel" Text="Auto-detect" FontSize="10" FontAttributes="Bold" TextColor="#8b5cf6" VerticalOptions="Center" />
                                </Border>
                            </HorizontalStackLayout>
                        </HorizontalStackLayout>
                    </Grid>

                    <!-- Transcript Editor Area -->
                    <Border Grid.Row="1"
                            BackgroundColor="{DynamicResource BackgroundSecondary}"
                            StrokeShape="RoundRectangle 10"
                            Stroke="Transparent"
                            StrokeThickness="0"
                            Margin="24,12,24,24">
                        <Grid>
                            <Grid.GestureRecognizers>
                                <PointerGestureRecognizer PointerEntered="OnTranscriptAreaHoverEnter" PointerExited="OnTranscriptAreaHoverExit" />
                            </Grid.GestureRecognizers>
                            
                            <!-- Subtle Watermark Logo (visible in empty state) -->
                            <Image x:Name="WatermarkLogo"
                                   Source="watermark_light.png"
                                   Opacity="0.03"
                                   Aspect="AspectFit"
                                   HorizontalOptions="Fill"
                                   VerticalOptions="Fill"
                                   Margin="0"
                                   InputTransparent="True" />
                            
                            <!-- Empty/Waiting State -->
                            <VerticalStackLayout x:Name="EmptyTranscriptState"
                                                 VerticalOptions="Center"
                                                 HorizontalOptions="Center"
                                                 Margin="0,0,0,40"
                                                 Spacing="24">
                                
                                <!-- Title -->
                                <Label x:Name="EmptyStateTitle"
                                       Text="Ready to transcribe"
                                       FontSize="24"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource TextPrimary}"
                                       HorizontalOptions="Center" />

                                <!-- Initial State: Steps (shown when no file loaded) -->
                                <VerticalStackLayout x:Name="InitialStepsPanel" Spacing="16" HorizontalOptions="Center">
                                    <Label x:Name="EmptyStateSubtitle"
                                           Text="Convert speech to text in seconds"
                                           FontSize="14"
                                           TextColor="{DynamicResource TextSecondary}"
                                           HorizontalOptions="Center" />

                                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                                        <HorizontalStackLayout Spacing="14">
                                            <Border x:Name="Step1Badge"
                                                    BackgroundColor="{DynamicResource AccentSurface}"
                                                    StrokeShape="RoundRectangle 14"
                                                    Stroke="{DynamicResource AccentPrimary}"
                                                    StrokeThickness="2"
                                                    HeightRequest="28"
                                                    WidthRequest="28">
                                                <Label x:Name="Step1Label" Text="1" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource AccentText}" HorizontalOptions="Center" VerticalOptions="Center" />
                                            </Border>
                                            <Label x:Name="Step1Text"
                                                   Text="Select or drop an audio file"
                                                   FontSize="14"
                                                   TextColor="{DynamicResource TextPrimary}"
                                                   VerticalOptions="Center" />
                                        </HorizontalStackLayout>

                                        <HorizontalStackLayout Spacing="14">
                                            <Border x:Name="Step2Badge"
                                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                    StrokeShape="RoundRectangle 14"
                                                    Stroke="{DynamicResource SurfaceBorder}"
                                                    StrokeThickness="1.5"
                                                    HeightRequest="28"
                                                    WidthRequest="28">
                                                <Label x:Name="Step2Label" Text="2" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextTertiary}" HorizontalOptions="Center" VerticalOptions="Center" />
                                            </Border>
                                            <Label x:Name="Step2Text"
                                                   Text="Click Transcribe to start"
                                                   FontSize="14"
                                                   TextColor="{DynamicResource TextSecondary}"
                                                   VerticalOptions="Center" />
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>

                                    <Label x:Name="SupportedFormatsLabel"
                                           Text="Supports WAV, MP3, FLAC, OGG, M4A, MP4, AVI, MOV"
                                           FontSize="12"
                                           TextColor="{DynamicResource TextMuted}"
                                           HorizontalOptions="Center" />
                                </VerticalStackLayout>

                                <!-- Loading State: Shown while file is being loaded -->
                                <VerticalStackLayout x:Name="FileLoadingPanel" Spacing="20" HorizontalOptions="Center" IsVisible="False">
                                    <ActivityIndicator IsRunning="True" 
                                                       Color="{DynamicResource AccentPrimary}" 
                                                       HeightRequest="48" 
                                                       WidthRequest="48" />
                                    <Label x:Name="LoadingFileName"
                                           Text=""
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource TextPrimary}"
                                           HorizontalOptions="Center"
                                           MaximumWidthRequest="350"
                                           LineBreakMode="TailTruncation" />
                                    <Label Text="{l:Translate ExtractingAudio}"
                                           FontSize="13"
                                           TextColor="{DynamicResource TextSecondary}"
                                           HorizontalOptions="Center" />
                                </VerticalStackLayout>

                                <!-- File Loaded State: File info + controls (shown when file loaded) -->
                                <VerticalStackLayout x:Name="TranscriptionControlsPanel" Spacing="20" HorizontalOptions="Center" IsVisible="False">
                                    
                                    <!-- File Info Card -->
                                    <Border BackgroundColor="{DynamicResource BackgroundTertiary}"
                                            StrokeShape="RoundRectangle 12"
                                            Stroke="{DynamicResource SurfaceBorder}"
                                            StrokeThickness="1"
                                            Padding="24,20"
                                            HorizontalOptions="Center">
                                        <HorizontalStackLayout Spacing="16">
                                            <Border BackgroundColor="{DynamicResource AccentSurface}"
                                                    StrokeShape="RoundRectangle 10"
                                                    Stroke="{DynamicResource AccentMuted}"
                                                    StrokeThickness="1"
                                                    HeightRequest="48"
                                                    WidthRequest="48">
                                                <Label Text="â™ª" FontSize="22" TextColor="{DynamicResource AccentPrimary}" 
                                                       HorizontalOptions="Center" VerticalOptions="Center" />
                                            </Border>
                                            <VerticalStackLayout Spacing="4" VerticalOptions="Center">
                                                <Label x:Name="CenterFileName"
                                                       Text="audio_file.mp3"
                                                       FontSize="15"
                                                       FontAttributes="Bold"
                                                       TextColor="{DynamicResource TextPrimary}"
                                                       MaximumWidthRequest="280"
                                                       LineBreakMode="TailTruncation" />
                                                <Label x:Name="CenterFileInfo"
                                                       Text="12.5 MB Â· 05:32"
                                                       FontSize="13"
                                                       TextColor="{DynamicResource TextSecondary}" />
                                            </VerticalStackLayout>
                                        </HorizontalStackLayout>
                                    </Border>

                                    <!-- Language and VAD Row -->
                                    <HorizontalStackLayout Spacing="24" HorizontalOptions="Center">
                                        <!-- Language Selector -->
                                        <HorizontalStackLayout Spacing="10">
                                            <Label Text="{l:Translate Language}" 
                                                   FontSize="13" 
                                                   TextColor="{DynamicResource TextSecondary}" 
                                                   VerticalOptions="Center" />
                                            <Border x:Name="TranscriptionLanguageButton"
                                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                    StrokeShape="RoundRectangle 6"
                                                    Stroke="{DynamicResource SurfaceBorder}"
                                                    StrokeThickness="1"
                                                    Padding="12,8,10,8"
                                                    VerticalOptions="Center">
                                                <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="8">
                                                    <Label x:Name="TranscriptionLanguageLabel" 
                                                           Text="Auto-detect" 
                                                           FontSize="13" 
                                                           TextColor="{DynamicResource TextPrimary}" 
                                                           VerticalOptions="Center" />
                                                    <Label Grid.Column="1" 
                                                           Text="â–¼" 
                                                           FontSize="8" 
                                                           TextColor="{DynamicResource TextMuted}" 
                                                           VerticalOptions="Center" />
                                                </Grid>
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnTranscriptionLanguageButtonClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnTranscriptionLanguageButtonHoverEnter" PointerExited="OnTranscriptionLanguageButtonHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                        </HorizontalStackLayout>
                                        
                                        <!-- VAD Toggle Switch -->
                                        <HorizontalStackLayout Spacing="10" VerticalOptions="Center"
                                                               ToolTipProperties.Text="{l:Translate VadTooltip}">
                                            <Label x:Name="VadToggleLabel"
                                                   Text="{l:Translate VAD}"
                                                   FontSize="13"
                                                   TextColor="{DynamicResource TextSecondary}"
                                                   VerticalOptions="Center" />
                                            <Border x:Name="VadToggleButton"
                                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                    StrokeShape="RoundRectangle 12"
                                                    Stroke="{DynamicResource SurfaceBorder}"
                                                    StrokeThickness="1"
                                                    WidthRequest="44"
                                                    HeightRequest="24"
                                                    Padding="2"
                                                    VerticalOptions="Center">
                                                <Grid>
                                                    <Border x:Name="VadToggleKnob"
                                                            BackgroundColor="{DynamicResource TextMuted}"
                                                            StrokeShape="RoundRectangle 10"
                                                            Stroke="Transparent"
                                                            WidthRequest="20"
                                                            HeightRequest="20"
                                                            HorizontalOptions="Start"
                                                            VerticalOptions="Center" />
                                                </Grid>
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnVadToggleClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnVadToggleHoverEnter" PointerExited="OnVadToggleHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                        </HorizontalStackLayout>
                                    </HorizontalStackLayout>

                                    <!-- Model Toggle - single row -->
                                    <HorizontalStackLayout Spacing="12" HorizontalOptions="Center">
                                        <HorizontalStackLayout x:Name="ModelToggleContainer" Spacing="0">
                                            <Border x:Name="TurboButton"
                                                    BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                    StrokeShape="RoundRectangle 8,0,0,8"
                                                    Stroke="{DynamicResource SurfaceBorder}"
                                                    StrokeThickness="1"
                                                    Padding="14,10"
                                                    Margin="0,0,-1,0">
                                                <HorizontalStackLayout Spacing="6">
                                                    <Label Text="âš¡" FontSize="13" VerticalOptions="Center" />
                                                    <Label x:Name="TurboButtonLabel"
                                                           Text="{l:Translate Turbo}"
                                                           FontSize="13"
                                                           TextColor="{DynamicResource TextSecondary}"
                                                           VerticalOptions="Center" />
                                                </HorizontalStackLayout>
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnTurboModeSelected" />
                                                    <PointerGestureRecognizer PointerEntered="OnTurboHoverEnter" PointerExited="OnTurboHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Border x:Name="AccurateButton"
                                                    BackgroundColor="{DynamicResource AccentSurface}"
                                                    StrokeShape="RoundRectangle 0,8,8,0"
                                                    Stroke="{DynamicResource AccentPrimary}"
                                                    StrokeThickness="1"
                                                    Padding="14,10">
                                                <HorizontalStackLayout Spacing="6">
                                                    <Label Text="âœ“" FontSize="13" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                                    <Label x:Name="AccurateButtonLabel"
                                                           Text="{l:Translate Accurate}"
                                                           FontSize="13"
                                                           FontAttributes="Bold"
                                                           TextColor="{DynamicResource AccentText}"
                                                           VerticalOptions="Center" />
                                                </HorizontalStackLayout>
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnAccurateModeSelected" />
                                                    <PointerGestureRecognizer PointerEntered="OnAccurateHoverEnter" PointerExited="OnAccurateHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                        </HorizontalStackLayout>
                                    </HorizontalStackLayout>

                                    <!-- Auto-transcribe Toggle -->
                                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Center" VerticalOptions="Center">
                                        <Label x:Name="AutoTranscribeInlineLabel"
                                               Text="Auto-transcribe on import"
                                               FontSize="13"
                                               TextColor="{DynamicResource TextSecondary}"
                                               VerticalOptions="Center" />
                                        <Border x:Name="AutoTranscribeInlineToggle"
                                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                StrokeShape="RoundRectangle 12"
                                                Stroke="{DynamicResource SurfaceBorder}"
                                                StrokeThickness="1"
                                                WidthRequest="44"
                                                HeightRequest="24"
                                                Padding="2"
                                                VerticalOptions="Center">
                                            <Grid>
                                                <Border x:Name="AutoTranscribeKnob"
                                                        BackgroundColor="{DynamicResource TextMuted}"
                                                        StrokeShape="RoundRectangle 10"
                                                        Stroke="Transparent"
                                                        WidthRequest="20"
                                                        HeightRequest="20"
                                                        HorizontalOptions="Start"
                                                        VerticalOptions="Center" />
                                            </Grid>
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnAutoTranscribeInlineToggleClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnAutoTranscribeInlineHoverEnter" PointerExited="OnAutoTranscribeInlineHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                    </HorizontalStackLayout>

                                    <!-- Transcribe / Cancel buttons -->
                                    <HorizontalStackLayout Spacing="12" HorizontalOptions="Center">
                                        <!-- Cancel Button (shown during transcription) -->
                                        <Border x:Name="CancelTranscriptionButton"
                                                BackgroundColor="{DynamicResource DangerSurface}"
                                                Stroke="{DynamicResource DangerColor}"
                                                StrokeShape="RoundRectangle 10"
                                                StrokeThickness="1"
                                                Padding="28,12"
                                                IsVisible="False">
                                            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                                <Label x:Name="CancelTranscriptionIcon" Text="âœ•" FontSize="14" TextColor="{DynamicResource DangerColor}" VerticalOptions="Center" />
                                                <Label x:Name="CancelTranscriptionText" Text="{l:Translate Cancel}" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource DangerColor}" VerticalOptions="Center" />
                                            </HorizontalStackLayout>
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnCancelTranscriptionClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnCancelTranscriptionHoverEnter" PointerExited="OnCancelTranscriptionHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>

                                        <!-- Transcribe Button -->
                                        <Border x:Name="TranscribeButton"
                                                BackgroundColor="{DynamicResource AccentPrimary}"
                                                Stroke="Transparent"
                                                StrokeShape="RoundRectangle 10"
                                                StrokeThickness="0"
                                                Padding="32,12"
                                                IsVisible="False">
                                            <Border.Shadow>
                                                <Shadow Brush="{DynamicResource AccentPrimary}" Offset="0,3" Radius="10" Opacity="0.35" />
                                            </Border.Shadow>
                                            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                                <Label x:Name="TranscribeIcon" Text="â–¶" FontSize="14" TextColor="#1C1508" VerticalOptions="Center" />
                                                <Label x:Name="TranscribeButtonText" Text="{l:Translate Transcribe}" FontSize="15" FontAttributes="Bold" TextColor="#1C1508" VerticalOptions="Center" />
                                            </HorizontalStackLayout>
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnTranscribeClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnTranscribeHoverEnter" PointerExited="OnTranscribeHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </VerticalStackLayout>

                            <!-- Model Loading State -->
                            <VerticalStackLayout x:Name="ModelLoadingState"
                                                 IsVisible="False"
                                                 VerticalOptions="Center"
                                                 HorizontalOptions="Center"
                                                 Spacing="12">
                                <ActivityIndicator IsRunning="True" 
                                                   Color="{DynamicResource AccentPrimary}"
                                                   HeightRequest="32"
                                                   WidthRequest="32" />
                                <Label x:Name="ModelLoadingLabel"
                                       Text="Loading model..."
                                       FontSize="13"
                                       TextColor="{DynamicResource TextSecondary}"
                                       HorizontalOptions="Center" />
                                <Label x:Name="ModelLoadingDetail"
                                       Text=""
                                       FontSize="11"
                                       TextColor="{DynamicResource TextMuted}"
                                       HorizontalOptions="Center" />
                            </VerticalStackLayout>

                            <!-- Transcript Display -->
                            <Grid x:Name="TranscriptContainer" IsVisible="False">
                                <!-- Unified Segments View (default view) -->
                                <ScrollView x:Name="SegmentsScrollView"
                                            VerticalScrollBarVisibility="Always"
                                            HorizontalScrollBarVisibility="Never">
                                    <VerticalStackLayout x:Name="SegmentsList" 
                                                         Spacing="4" 
                                                         Padding="12,12,12,12" />
                                </ScrollView>
                                
                                <!-- Document View (formatted text view) -->
                                <ScrollView x:Name="DocumentScrollView"
                                            VerticalScrollBarVisibility="Always"
                                            HorizontalScrollBarVisibility="Never"
                                            IsVisible="False"
                                            Padding="20,16,20,32">
                                    <Border x:Name="DocumentBorder"
                                            BackgroundColor="{DynamicResource SurfaceColor}"
                                            StrokeShape="RoundRectangle 16"
                                            Stroke="{DynamicResource SurfaceBorder}"
                                            StrokeThickness="1"
                                            Padding="32,28,32,40">
                                        <Border.Shadow>
                                            <Shadow Brush="#000000" Offset="0,2" Radius="12" Opacity="0.12" />
                                        </Border.Shadow>
                                        <Editor x:Name="DocumentLabel"
                                                FontSize="14"
                                                TextColor="{DynamicResource TextPrimary}"
                                                BackgroundColor="Transparent"
                                                AutoSize="TextChanges"
                                                IsReadOnly="True" />
                                    </Border>
                                </ScrollView>
                                
                                <!-- Search Bar - floating at top left -->
                                <Border x:Name="SearchBar"
                                        BackgroundColor="{DynamicResource SurfaceColor}"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="{DynamicResource SurfaceBorder}"
                                        StrokeThickness="1"
                                        Padding="10,6"
                                        Margin="12,8,80,0"
                                        HorizontalOptions="Fill"
                                        VerticalOptions="Start"
                                        IsVisible="False"
                                        Shadow="{Shadow Brush='#40000000', Offset='0,2', Radius='8', Opacity='0.3'}">
                                    <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="8">
                                        <!-- Search Icon -->
                                        <Label Text="âŒ•" 
                                               FontSize="15" 
                                               VerticalOptions="Center" 
                                               TextColor="{DynamicResource TextTertiary}" />
                                        
                                        <!-- Search Input -->
                                        <Entry x:Name="SearchEntry"
                                               Grid.Column="1"
                                               Placeholder="Find in transcript..."
                                               FontSize="13"
                                               HeightRequest="30"
                                               BackgroundColor="{DynamicResource BackgroundSecondary}"
                                               TextColor="{DynamicResource TextPrimary}"
                                               PlaceholderColor="{DynamicResource TextMuted}"
                                               TextChanged="OnSearchTextChanged"
                                               Completed="OnSearchEntryCompleted" />
                                        
                                        <!-- Match Count -->
                                        <Label x:Name="SearchMatchCount"
                                               Grid.Column="2"
                                               Text="0/0"
                                               FontSize="11"
                                               TextColor="{DynamicResource TextTertiary}"
                                               VerticalOptions="Center"
                                               MinimumWidthRequest="45" />
                                        
                                        <!-- Previous Match -->
                                        <Border x:Name="SearchPrevButton"
                                                Grid.Column="3"
                                                BackgroundColor="Transparent"
                                                StrokeShape="RoundRectangle 4"
                                                Stroke="Transparent"
                                                StrokeThickness="0"
                                                Padding="8,4"
                                                ToolTipProperties.Text="Previous match (Shift+Enter)">
                                            <Label Text="âˆ§" FontSize="14" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" HorizontalOptions="Center" />
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnSearchPreviousClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnSearchNavButtonHoverEnter" PointerExited="OnSearchNavButtonHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                        
                                        <!-- Next Match -->
                                        <Border x:Name="SearchNextButton"
                                                Grid.Column="4"
                                                BackgroundColor="Transparent"
                                                StrokeShape="RoundRectangle 4"
                                                Stroke="Transparent"
                                                StrokeThickness="0"
                                                Padding="8,4"
                                                ToolTipProperties.Text="Next match (Enter)">
                                            <Label Text="âˆ¨" FontSize="14" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" HorizontalOptions="Center" />
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnSearchNextClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnSearchNavButtonHoverEnter" PointerExited="OnSearchNavButtonHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                        
                                        <!-- Separator -->
                                        <BoxView Grid.Column="5" WidthRequest="1" HeightRequest="18" Color="{DynamicResource SurfaceBorder}" VerticalOptions="Center" />
                                        
                                        <!-- Close Button -->
                                        <Border x:Name="SearchCloseButton"
                                                Grid.Column="6"
                                                BackgroundColor="Transparent"
                                                StrokeShape="RoundRectangle 4"
                                                Stroke="Transparent"
                                                StrokeThickness="0"
                                                Padding="8,4"
                                                ToolTipProperties.Text="Close (Escape)">
                                            <Label Text="âœ•" FontSize="12" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" HorizontalOptions="Center" />
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnSearchCloseClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnSearchNavButtonHoverEnter" PointerExited="OnSearchNavButtonHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                    </Grid>
                                </Border>
                                
                                <!-- Floating Font Size Controls - top right, fades in on hover -->
                                <Border x:Name="FontSizeControls"
                                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                                        StrokeShape="RoundRectangle 6"
                                        Stroke="{DynamicResource SurfaceBorder}"
                                        StrokeThickness="1"
                                        Padding="3,2"
                                        Margin="0,8,14,0"
                                        Opacity="0"
                                        HorizontalOptions="End"
                                        VerticalOptions="Start">
                                    <HorizontalStackLayout Spacing="0" VerticalOptions="Center">
                                        <Border x:Name="FontDecreaseButton"
                                                BackgroundColor="Transparent"
                                                StrokeShape="RoundRectangle 4"
                                                Stroke="Transparent"
                                                StrokeThickness="0"
                                                Padding="5,3"
                                                HeightRequest="24"
                                                WidthRequest="24"
                                                ToolTipProperties.Text="Decrease font size">
                                            <Label Text="A" FontSize="11" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" VerticalOptions="End" />
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnFontDecreaseClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnFontButtonHoverEnter" PointerExited="OnFontButtonHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                        <BoxView WidthRequest="1" HeightRequest="14" Color="{DynamicResource SurfaceBorder}" VerticalOptions="Center" Margin="2,0" />
                                        <Border x:Name="FontIncreaseButton"
                                                BackgroundColor="Transparent"
                                                StrokeShape="RoundRectangle 4"
                                                Stroke="Transparent"
                                                StrokeThickness="0"
                                                Padding="5,3"
                                                HeightRequest="24"
                                                WidthRequest="24"
                                                ToolTipProperties.Text="Increase font size">
                                            <Label Text="A" FontSize="15" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" VerticalOptions="End" />
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnFontIncreaseClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnFontButtonHoverEnter" PointerExited="OnFontButtonHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                    </HorizontalStackLayout>
                                </Border>
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- Progress Bar -->
                    <Border x:Name="ProgressPanel"
                            Grid.Row="2"
                            BackgroundColor="{DynamicResource BackgroundTertiary}"
                            StrokeShape="RoundRectangle 8"
                            Stroke="{DynamicResource SurfaceBorder}"
                            StrokeThickness="1"
                            Padding="16,12"
                            Margin="24,12,24,24"
                            IsVisible="False">
                        <Grid RowDefinitions="Auto,Auto">
                            <Grid ColumnDefinitions="Auto,Auto,*,Auto">
                                <ActivityIndicator IsRunning="True" 
                                                   Color="{DynamicResource AccentPrimary}"
                                                   HeightRequest="18"
                                                   WidthRequest="18"
                                                   VerticalOptions="Center" />
                                <Label x:Name="ProgressLabel"
                                       Grid.Column="1"
                                       Text="Transcribing..."
                                       FontSize="12"
                                       TextColor="{DynamicResource TextSecondary}"
                                       VerticalOptions="Center"
                                       Margin="10,0,0,0" />
                                <Border Grid.Column="2"
                                        BackgroundColor="{DynamicResource SurfaceBorder}"
                                        StrokeShape="RoundRectangle 3"
                                        StrokeThickness="0"
                                        HeightRequest="6"
                                        Margin="16,0"
                                        VerticalOptions="Center">
                                    <ProgressBar x:Name="TranscriptionProgress"
                                                 Progress="0"
                                                 ProgressColor="{DynamicResource AccentPrimary}"
                                                 BackgroundColor="Transparent"
                                                 HeightRequest="6" />
                                </Border>
                                <Label x:Name="ProgressDetailLabel"
                                       Grid.Column="3"
                                       Text="0%"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource AccentText}"
                                       VerticalOptions="Center" />
                            </Grid>
                            <HorizontalStackLayout Grid.Row="1"
                                                   HorizontalOptions="End"
                                                   Spacing="4"
                                                   Margin="0,6,0,0">
                                <Label x:Name="ElapsedTimeLabel"
                                       Text=""
                                       FontSize="10"
                                       TextColor="{DynamicResource TextMuted}"
                                       IsVisible="False" />
                                <Label x:Name="TimeSeparatorLabel"
                                       Text="Â·"
                                       FontSize="10"
                                       TextColor="{DynamicResource TextMuted}"
                                       IsVisible="False" />
                                <Label x:Name="EstimatedTimeLabel"
                                       Text=""
                                       FontSize="10"
                                       TextColor="{DynamicResource TextMuted}"
                                       IsVisible="False" />
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>

                    <!-- Action Buttons -->
                    <HorizontalStackLayout x:Name="ResultActions"
                                           Grid.Row="4" 
                                           Spacing="8" 
                                           Padding="24,12,24,24"
                                           HorizontalOptions="End"
                                           IsVisible="False">
                        <Border x:Name="CopyButton"
                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeShape="RoundRectangle 6"
                                StrokeThickness="1"
                                Padding="14,6"
                                HeightRequest="32"
                                ToolTipProperties.Text="Copy transcript to clipboard">
                            <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                <Label Text="â§‰" FontSize="13" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                <Label x:Name="CopyButtonLabel" Text="Copy" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                            </HorizontalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnCopyClicked" />
                                <PointerGestureRecognizer PointerEntered="OnCopyButtonHoverEnter" PointerExited="OnCopyButtonHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                        <Border x:Name="SaveButton"
                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeShape="RoundRectangle 6"
                                StrokeThickness="1"
                                Padding="14,6"
                                HeightRequest="32"
                                ToolTipProperties.Text="Export to TXT, DOCX, RTF, SRT or VTT">
                            <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                <Label Text="â†“" FontSize="13" TextColor="{DynamicResource SuccessColor}" VerticalOptions="Center" />
                                <Label x:Name="ExportButtonLabel" Text="Export" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                            </HorizontalStackLayout>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnSaveClicked" />
                                <PointerGestureRecognizer PointerEntered="OnSaveButtonHoverEnter" PointerExited="OnSaveButtonHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                    </HorizontalStackLayout>

                    <!-- History Playback Panel (shown when viewing history with audio available) -->
                    <Border x:Name="HistoryPlaybackPanel"
                            Grid.Row="5"
                            BackgroundColor="{DynamicResource BackgroundTertiary}"
                            StrokeShape="RoundRectangle 6"
                            Stroke="{DynamicResource SurfaceBorder}"
                            StrokeThickness="1"
                            Padding="12,10"
                            Margin="24,0,24,20"
                            IsVisible="False">
                        <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto">
                            <!-- Play/Pause Button -->
                            <Border x:Name="HistoryPlayPauseButton"
                                    BackgroundColor="{DynamicResource AccentPrimary}"
                                    StrokeShape="RoundRectangle 4"
                                    Stroke="Transparent"
                                    StrokeThickness="0"
                                    HeightRequest="30"
                                    WidthRequest="30"
                                    VerticalOptions="Center">
                                <Label x:Name="HistoryPlayPauseIcon" 
                                       Text="â–¶" 
                                       FontSize="12" 
                                       TextColor="White" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center" />
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnHistoryPlayPauseClicked" />
                                    <PointerGestureRecognizer PointerEntered="OnHistoryPlayPauseHoverEnter" PointerExited="OnHistoryPlayPauseHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Time Display -->
                            <HorizontalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center" Margin="10,0,0,0">
                                <Label x:Name="HistoryCurrentTimeLabel" Text="0:00" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                <Label x:Name="HistoryTimeSeparator" Text="/" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                <Label x:Name="HistoryTotalTimeLabel" Text="0:00" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                            </HorizontalStackLayout>

                            <!-- Timeline Slider -->
                            <Slider x:Name="HistoryPlaybackSlider"
                                    Grid.Column="2"
                                    Minimum="0"
                                    Maximum="100"
                                    Value="0"
                                    Margin="10,0"
                                    VerticalOptions="Center"
                                    ValueChanged="OnHistoryPlaybackSliderChanged"
                                    DragStarted="OnHistoryPlaybackSliderDragStarted"
                                    DragCompleted="OnHistoryPlaybackSliderDragCompleted" />

                            <!-- Volume Control -->
                            <HorizontalStackLayout Grid.Column="3" Spacing="4" VerticalOptions="Center" Margin="0,0,6,0">
                                <Label x:Name="HistoryVolumeIcon" Text="ðŸ”Š" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                <Slider x:Name="HistoryVolumeSlider"
                                        Minimum="0"
                                        Maximum="1"
                                        Value="0.8"
                                        WidthRequest="70"
                                        VerticalOptions="Center"
                                        ValueChanged="OnHistoryVolumeChanged" />
                            </HorizontalStackLayout>

                            <!-- Speed Control - Elegant Pill Design -->
                            <Border x:Name="HistorySpeedContainer"
                                    Grid.Column="4"
                                    BackgroundColor="{DynamicResource BackgroundSecondary}"
                                    StrokeShape="RoundRectangle 12"
                                    Stroke="{DynamicResource SurfaceBorder}"
                                    StrokeThickness="1"
                                    Padding="2"
                                    Margin="6,0"
                                    VerticalOptions="Center">
                                <HorizontalStackLayout Spacing="0">
                                    <!-- Slow Button -->
                                    <Border x:Name="SpeedSlowButton"
                                            BackgroundColor="Transparent"
                                            StrokeShape="RoundRectangle 10"
                                            Stroke="Transparent"
                                            Padding="6,4"
                                            WidthRequest="28">
                                        <Label x:Name="SpeedSlowLabel" 
                                               Text="âˆ’" 
                                               FontSize="14" 
                                               FontAttributes="Bold"
                                               TextColor="{DynamicResource TextPrimary}" 
                                               VerticalOptions="Center" 
                                               HorizontalOptions="Center" />
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnSpeedSlowClicked" />
                                            <PointerGestureRecognizer PointerEntered="OnSpeedSlowHoverEnter" PointerExited="OnSpeedSlowHoverExit" />
                                        </Border.GestureRecognizers>
                                    </Border>
                                    
                                    <!-- Current Speed Display (clickable to reset to 1x) -->
                                    <Border x:Name="SpeedValueButton"
                                            BackgroundColor="Transparent"
                                            StrokeShape="RoundRectangle 10"
                                            Stroke="Transparent"
                                            Padding="6,4"
                                            MinimumWidthRequest="44">
                                        <Label x:Name="HistorySpeedLabel" 
                                               Text="1Ã—" 
                                               FontSize="11" 
                                               FontAttributes="Bold"
                                               TextColor="{DynamicResource TextPrimary}" 
                                               VerticalOptions="Center" 
                                               HorizontalOptions="Center" />
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnSpeedResetClicked" />
                                            <PointerGestureRecognizer PointerEntered="OnSpeedValueHoverEnter" PointerExited="OnSpeedValueHoverExit" />
                                        </Border.GestureRecognizers>
                                    </Border>
                                    
                                    <!-- Fast Button -->
                                    <Border x:Name="SpeedFastButton"
                                            BackgroundColor="Transparent"
                                            StrokeShape="RoundRectangle 10"
                                            Stroke="Transparent"
                                            Padding="6,4"
                                            WidthRequest="28">
                                        <Label x:Name="SpeedFastLabel" 
                                               Text="+" 
                                               FontSize="14" 
                                               FontAttributes="Bold"
                                               TextColor="{DynamicResource TextPrimary}" 
                                               VerticalOptions="Center" 
                                               HorizontalOptions="Center" />
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnSpeedFastClicked" />
                                            <PointerGestureRecognizer PointerEntered="OnSpeedFastHoverEnter" PointerExited="OnSpeedFastHoverExit" />
                                        </Border.GestureRecognizers>
                                    </Border>
                                </HorizontalStackLayout>
                            </Border>

                            <!-- Separator -->
                            <BoxView x:Name="HistorySeparator1"
                                     Grid.Column="5" 
                                     WidthRequest="1" 
                                     HeightRequest="18" 
                                     Color="{DynamicResource SurfaceBorder}" 
                                     VerticalOptions="Center" 
                                     Margin="6,0" />

                            <!-- Transcript Date -->
                            <Label x:Name="HistoryDateLabel"
                                   Grid.Column="6"
                                   Text="Jan 19, 2026"
                                   FontSize="12"
                                   TextColor="{DynamicResource TextPrimary}"
                                   VerticalOptions="Center"
                                   Margin="6,0" />

                            <!-- Separator -->
                            <BoxView x:Name="HistorySeparator2"
                                     Grid.Column="7" 
                                     WidthRequest="1" 
                                     HeightRequest="18" 
                                     Color="{DynamicResource SurfaceBorder}" 
                                     VerticalOptions="Center" 
                                     Margin="6,0" />

                            <!-- Audio Source with Browse -->
                            <Label x:Name="HistoryAudioSourceLabel"
                                   Grid.Column="8"
                                   Text="audio.mp3"
                                   FontSize="12"
                                   TextColor="{DynamicResource TextPrimary}"
                                   VerticalOptions="Center"
                                   Margin="6,0,0,0"
                                   LineBreakMode="TailTruncation"
                                   MaximumWidthRequest="180" />

                            <!-- Browse Audio File Button -->
                            <Border x:Name="BrowseAudioFileButton"
                                    Grid.Column="9"
                                    BackgroundColor="Transparent"
                                    StrokeShape="RoundRectangle 4"
                                    Stroke="{DynamicResource SurfaceBorder}"
                                    StrokeThickness="1"
                                    Padding="6,3"
                                    Margin="6,0,0,0"
                                    VerticalOptions="Center"
                                    ToolTipProperties.Text="Open file location">
                                <Label x:Name="BrowseAudioFileIcon" Text="â†—" FontSize="12" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" VerticalOptions="Center" HorizontalOptions="Center" />
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnBrowseAudioFileClicked" />
                                    <PointerGestureRecognizer PointerEntered="OnBrowseAudioFileHoverEnter" PointerExited="OnBrowseAudioFileHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- Settings Panel (Overlay) -->
        <Grid x:Name="SettingsOverlay" 
              Grid.RowSpan="3"
              BackgroundColor="#80000000"
              IsVisible="False">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnSettingsOverlayClicked" />
            </Grid.GestureRecognizers>
            
            <Border BackgroundColor="{DynamicResource BackgroundSecondary}"
                    StrokeShape="RoundRectangle 16"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    Padding="0"
                    WidthRequest="520"
                    MaximumHeightRequest="580"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- Header (fixed) -->
                    <Grid ColumnDefinitions="*,Auto" Padding="24,16">
                        <HorizontalStackLayout Spacing="10">
                            <!-- Modern sliders icon -->
                            <Grid HeightRequest="18" WidthRequest="18" VerticalOptions="Center">
                                <Line X1="0" Y1="4" X2="18" Y2="4" Stroke="{DynamicResource AccentText}" StrokeThickness="2" StrokeLineCap="Round" />
                                <Line X1="0" Y1="9" X2="18" Y2="9" Stroke="{DynamicResource AccentText}" StrokeThickness="2" StrokeLineCap="Round" />
                                <Line X1="0" Y1="14" X2="18" Y2="14" Stroke="{DynamicResource AccentText}" StrokeThickness="2" StrokeLineCap="Round" />
                                <Ellipse Fill="{DynamicResource AccentText}" WidthRequest="5" HeightRequest="5" HorizontalOptions="Start" VerticalOptions="Start" Margin="4,1.5,0,0" />
                                <Ellipse Fill="{DynamicResource AccentText}" WidthRequest="5" HeightRequest="5" HorizontalOptions="Start" VerticalOptions="Start" Margin="10,6.5,0,0" />
                                <Ellipse Fill="{DynamicResource AccentText}" WidthRequest="5" HeightRequest="5" HorizontalOptions="Start" VerticalOptions="Start" Margin="6,11.5,0,0" />
                            </Grid>
                            <Label x:Name="SettingsTitle"
                                   Text="Settings"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource TextPrimary}"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                        <Border x:Name="CloseSettingsButton"
                                Grid.Column="1"
                                BackgroundColor="Transparent"
                                Stroke="Transparent"
                                StrokeShape="RoundRectangle 4"
                                StrokeThickness="1"
                                Padding="6,2"
                                VerticalOptions="Center">
                            <Label Text="âœ•"
                                   FontSize="16"
                                   TextColor="{DynamicResource TextTertiary}"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnCloseSettingsClicked" />
                                <PointerGestureRecognizer PointerEntered="OnCloseSettingsHoverEnter" PointerExited="OnCloseSettingsHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                    </Grid>

                    <!-- Scrollable Content (different background) -->
                    <Border Grid.Row="1" BackgroundColor="{DynamicResource SurfaceColor}" Margin="8,0" StrokeShape="RoundRectangle 8" Stroke="Transparent">
                        <ScrollView Padding="16,12">
                            <VerticalStackLayout Spacing="14">
                                <!-- GENERAL SETTINGS SECTION -->
                                <HorizontalStackLayout Spacing="6">
                                    <Label Text="âš™" FontSize="12" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                    <Label x:Name="GeneralSettingsHeader" Text="General" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextTertiary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>

                                <!-- Language -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                        <Label x:Name="LanguageLabel" Text="Language" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="LanguageDescription" Text="Choose your preferred language" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    
                                    <!-- Custom Language Selector Button -->
                                    <Border x:Name="LanguageDropdownButton" 
                                            Grid.Column="1"
                                            BackgroundColor="{DynamicResource BackgroundTertiary}" 
                                            StrokeShape="RoundRectangle 6" 
                                            Stroke="{DynamicResource SurfaceBorder}" 
                                            StrokeThickness="1" 
                                            Padding="10,6,8,6" 
                                            VerticalOptions="Center">
                                        <Grid ColumnDefinitions="Auto,Auto,Auto" ColumnSpacing="8">
                                            <!-- Flag icon for selected language -->
                                            <Grid x:Name="SelectedFlagContainer" WidthRequest="20" HeightRequest="14" VerticalOptions="Center">
                                                <!-- UK Flag (default) -->
                                                <Grid x:Name="UKFlagSelected" IsVisible="True">
                                                    <BoxView Color="#012169" CornerRadius="2" />
                                                    <BoxView Color="White" WidthRequest="4" HorizontalOptions="Center" />
                                                    <BoxView Color="White" HeightRequest="3" VerticalOptions="Center" />
                                                    <BoxView Color="#C8102E" WidthRequest="2" HorizontalOptions="Center" />
                                                    <BoxView Color="#C8102E" HeightRequest="1.5" VerticalOptions="Center" />
                                                </Grid>
                                                <!-- French Flag -->
                                                <Grid x:Name="FRFlagSelected" IsVisible="False" ColumnDefinitions="*,*,*">
                                                    <BoxView Color="#002395" CornerRadius="2,0,0,2" />
                                                    <BoxView Grid.Column="1" Color="White" />
                                                    <BoxView Grid.Column="2" Color="#ED2939" CornerRadius="0,2,2,0" />
                                                </Grid>
                                            </Grid>
                                            <Label x:Name="SelectedLanguageLabel" Grid.Column="1" Text="English" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <!-- Dropdown chevron -->
                                            <Label Grid.Column="2" Text="â–¼" FontSize="8" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                        </Grid>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnLanguageDropdownClicked" />
                                            <PointerGestureRecognizer PointerEntered="OnLanguageButtonHoverEnter" PointerExited="OnLanguageButtonHoverExit" />
                                        </Border.GestureRecognizers>
                                    </Border>
                                </Grid>

                                <!-- Dark Mode -->
                                <Grid ColumnDefinitions="*,50">
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                        <Label x:Name="DarkModeLabel" Text="Dark Mode" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="DarkModeDescription" Text="Switch between light and dark theme" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    <controls:CustomToggle x:Name="DarkModeToggle" Grid.Column="1" IsToggled="True" OnColor="{DynamicResource AccentPrimary}" VerticalOptions="Center" HorizontalOptions="End" Toggled="OnDarkModeToggled" />
                                </Grid>

                                <!-- TRANSCRIPTION SETTINGS SECTION -->
                                <HorizontalStackLayout Spacing="6" Margin="0,6,0,0">
                                    <Label Text="ðŸŽ™" FontSize="12" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                    <Label x:Name="TranscriptionSettingsHeader" Text="Transcription" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextTertiary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>

                                <!-- Voice Activity Detection -->
                                <Grid ColumnDefinitions="*,50">
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                        <Label x:Name="VadSettingLabel" Text="Voice Activity Detection" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="VadSettingDescription" Text="Filter out silence and non-speech audio" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    <controls:CustomToggle x:Name="VadToggle" Grid.Column="1" IsToggled="True" OnColor="{DynamicResource AccentPrimary}" VerticalOptions="Center" HorizontalOptions="End" Toggled="OnVadToggled" />
                                </Grid>

                                <!-- Transcription Language -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                        <Label x:Name="TranscriptionLanguageSettingLabel" Text="Transcription Language" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="TranscriptionLanguageSettingDescription" Text="Language for speech recognition" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    <Border x:Name="SettingsLanguageButton"
                                            Grid.Column="1"
                                            BackgroundColor="{DynamicResource BackgroundTertiary}"
                                            StrokeShape="RoundRectangle 6"
                                            Stroke="{DynamicResource SurfaceBorder}"
                                            StrokeThickness="1"
                                            Padding="12,6,10,6"
                                            VerticalOptions="Center">
                                        <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="8">
                                            <Label x:Name="SettingsLanguageLabel" 
                                                   Text="Auto-detect" 
                                                   FontSize="12" 
                                                   TextColor="{DynamicResource TextPrimary}" 
                                                   VerticalOptions="Center" />
                                            <Label Grid.Column="1" 
                                                   Text="â–¼" 
                                                   FontSize="8" 
                                                   TextColor="{DynamicResource TextMuted}" 
                                                   VerticalOptions="Center" />
                                        </Grid>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnSettingsLanguageButtonClicked" />
                                            <PointerGestureRecognizer PointerEntered="OnSettingsLanguageButtonHoverEnter" PointerExited="OnSettingsLanguageButtonHoverExit" />
                                        </Border.GestureRecognizers>
                                    </Border>
                                </Grid>

                                <!-- Transcription Mode -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                        <Label x:Name="TranscriptionModeSettingLabel" Text="Transcription Mode" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="TranscriptionModeSettingDescription" Text="Balance between speed and accuracy" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    <HorizontalStackLayout Grid.Column="1" Spacing="0" VerticalOptions="Center">
                                        <Border x:Name="SettingsTurboButton"
                                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                StrokeShape="RoundRectangle 6,0,0,6"
                                                Stroke="{DynamicResource SurfaceBorder}"
                                                StrokeThickness="1"
                                                Padding="10,6"
                                                Margin="0,0,-1,0">
                                            <HorizontalStackLayout Spacing="4">
                                                <Label Text="âš¡" FontSize="11" VerticalOptions="Center" />
                                                <Label x:Name="SettingsTurboLabel"
                                                       Text="Turbo"
                                                       FontSize="11"
                                                       TextColor="{DynamicResource TextSecondary}"
                                                       VerticalOptions="Center" />
                                            </HorizontalStackLayout>
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnSettingsTurboClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnSettingsTurboHoverEnter" PointerExited="OnSettingsTurboHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                        <Border x:Name="SettingsAccurateButton"
                                                BackgroundColor="{DynamicResource AccentSurface}"
                                                StrokeShape="RoundRectangle 0,6,6,0"
                                                Stroke="{DynamicResource AccentPrimary}"
                                                StrokeThickness="1"
                                                Padding="10,6">
                                            <HorizontalStackLayout Spacing="4">
                                                <Label x:Name="SettingsAccurateIcon" Text="âœ“" FontSize="11" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                                <Label x:Name="SettingsAccurateLabel"
                                                       Text="Accurate"
                                                       FontSize="11"
                                                       FontAttributes="Bold"
                                                       TextColor="{DynamicResource AccentText}"
                                                       VerticalOptions="Center" />
                                            </HorizontalStackLayout>
                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnSettingsAccurateClicked" />
                                                <PointerGestureRecognizer PointerEntered="OnSettingsAccurateHoverEnter" PointerExited="OnSettingsAccurateHoverExit" />
                                            </Border.GestureRecognizers>
                                        </Border>
                                    </HorizontalStackLayout>
                                </Grid>

                                <!-- Auto-transcribe on import -->
                                <Grid ColumnDefinitions="*,50">
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                        <Label x:Name="AutoTranscribeLabel" Text="Auto-transcribe on import" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="AutoTranscribeDescription" Text="Automatically begin transcription when audio is loaded" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    <controls:CustomToggle x:Name="AutoTranscribeToggle" Grid.Column="1" IsToggled="False" OnColor="{DynamicResource AccentPrimary}" VerticalOptions="Center" HorizontalOptions="End" Toggled="OnAutoTranscribeToggled" />
                                </Grid>

                                <!-- Open Files After Export -->
                                <Grid ColumnDefinitions="*,50">
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                        <Label x:Name="OpenAfterExportLabel" Text="Open files after export" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="OpenAfterExportDescription" Text="Automatically open exported files" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    <controls:CustomToggle x:Name="OpenAfterExportToggle" Grid.Column="1" IsToggled="True" OnColor="{DynamicResource AccentPrimary}" VerticalOptions="Center" HorizontalOptions="End" Toggled="OnOpenAfterExportToggled" />
                                </Grid>

                                <!-- Dictation Formatting -->
                                <Grid ColumnDefinitions="*,Auto,50">
                                    <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                        <Label x:Name="DictationFormattingLabel" Text="Dictation formatting" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="DictationFormattingDescription" Text="Convert spoken commands (point, virgule, Ã  la ligne)" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    <Border x:Name="DictationHelpButton" Grid.Column="1" BackgroundColor="Transparent" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" StrokeThickness="1" Padding="6,2" Margin="0,0,8,0" VerticalOptions="Center">
                                        <Label Text="?" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource AccentText}" HorizontalOptions="Center" />
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnDictationHelpClicked" />
                                            <PointerGestureRecognizer PointerEntered="OnDictationHelpHoverEnter" PointerExited="OnDictationHelpHoverExit" />
                                        </Border.GestureRecognizers>
                                    </Border>
                                    <controls:CustomToggle x:Name="DictationFormattingToggle" Grid.Column="2" IsToggled="True" OnColor="{DynamicResource AccentPrimary}" VerticalOptions="Center" HorizontalOptions="End" Toggled="OnDictationFormattingToggled" />
                                </Grid>

                                <!-- Audio Input Device -->
                                <VerticalStackLayout Spacing="4">
                                    <Label x:Name="AudioInputLabel" Text="Audio Input" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                    <Label x:Name="AudioInputDescription" Text="Microphone for recording" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 6" Stroke="{DynamicResource BorderPrimary}" Padding="12,8" Margin="0,4,0,0">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="InputDeviceLabel" Text="Select input device" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Label Grid.Column="1" Text="â–¼" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                        </Grid>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnInputDeviceDropdownTapped" />
                                        </Border.GestureRecognizers>
                                    </Border>
                                </VerticalStackLayout>

                                <!-- PERFORMANCE SECTION -->
                                <HorizontalStackLayout Spacing="6" Margin="0,6,0,0">
                                    <Label Text="âš¡" FontSize="12" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                    <Label x:Name="PerformanceSettingsLabel" Text="Performance" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextTertiary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>

                                <!-- Resource Usage Setting -->
                                <VerticalStackLayout Spacing="8">
                                    <VerticalStackLayout Spacing="0">
                                        <Label x:Name="ResourceUsageLabel" Text="System Resource Usage" FontSize="13" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                        <Label x:Name="ResourceUsageDescription" Text="CPU threads allocated for transcription" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                    </VerticalStackLayout>
                                    
                                    <!-- Resource Level Selector -->
                                    <Border BackgroundColor="{DynamicResource BackgroundSecondary}" 
                                            StrokeShape="RoundRectangle 8" 
                                            Stroke="{DynamicResource SurfaceBorderSubtle}" 
                                            StrokeThickness="1" 
                                            Padding="12,10">
                                        <VerticalStackLayout Spacing="10">
                                            <!-- Level Buttons -->
                                            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="6">
                                                <!-- Level 1: Light -->
                                                <Border x:Name="ResourceLevel1Button"
                                                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                        StrokeShape="RoundRectangle 6"
                                                        Stroke="{DynamicResource SurfaceBorder}"
                                                        StrokeThickness="1"
                                                        Padding="8,10"
                                                        Grid.Column="0">
                                                    <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                                        <Label x:Name="ResourceLevel1Icon" Text="ðŸŒ±" FontSize="16" HorizontalOptions="Center" />
                                                        <Label x:Name="ResourceLevel1Label" Text="Light" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" />
                                                        <Label x:Name="ResourceLevel1Percent" Text="25%" FontSize="9" TextColor="{DynamicResource TextMuted}" HorizontalOptions="Center" />
                                                    </VerticalStackLayout>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Tapped="OnResourceLevel1Clicked" />
                                                        <PointerGestureRecognizer PointerEntered="OnResourceLevelHoverEnter" PointerExited="OnResourceLevelHoverExit" />
                                                    </Border.GestureRecognizers>
                                                </Border>
                                                
                                                <!-- Level 2: Balanced -->
                                                <Border x:Name="ResourceLevel2Button"
                                                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                        StrokeShape="RoundRectangle 6"
                                                        Stroke="{DynamicResource SurfaceBorder}"
                                                        StrokeThickness="1"
                                                        Padding="8,10"
                                                        Grid.Column="1">
                                                    <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                                        <Label x:Name="ResourceLevel2Icon" Text="âš–ï¸" FontSize="16" HorizontalOptions="Center" />
                                                        <Label x:Name="ResourceLevel2Label" Text="Balanced" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" />
                                                        <Label x:Name="ResourceLevel2Percent" Text="50%" FontSize="9" TextColor="{DynamicResource TextMuted}" HorizontalOptions="Center" />
                                                    </VerticalStackLayout>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Tapped="OnResourceLevel2Clicked" />
                                                        <PointerGestureRecognizer PointerEntered="OnResourceLevelHoverEnter" PointerExited="OnResourceLevelHoverExit" />
                                                    </Border.GestureRecognizers>
                                                </Border>
                                                
                                                <!-- Level 3: Performance -->
                                                <Border x:Name="ResourceLevel3Button"
                                                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                        StrokeShape="RoundRectangle 6"
                                                        Stroke="{DynamicResource SurfaceBorder}"
                                                        StrokeThickness="1"
                                                        Padding="8,10"
                                                        Grid.Column="2">
                                                    <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                                        <Label x:Name="ResourceLevel3Icon" Text="ðŸš€" FontSize="16" HorizontalOptions="Center" />
                                                        <Label x:Name="ResourceLevel3Label" Text="Performance" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" />
                                                        <Label x:Name="ResourceLevel3Percent" Text="75%" FontSize="9" TextColor="{DynamicResource TextMuted}" HorizontalOptions="Center" />
                                                    </VerticalStackLayout>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Tapped="OnResourceLevel3Clicked" />
                                                        <PointerGestureRecognizer PointerEntered="OnResourceLevelHoverEnter" PointerExited="OnResourceLevelHoverExit" />
                                                    </Border.GestureRecognizers>
                                                </Border>
                                                
                                                <!-- Level 4: Maximum -->
                                                <Border x:Name="ResourceLevel4Button"
                                                        BackgroundColor="{DynamicResource BackgroundTertiary}"
                                                        StrokeShape="RoundRectangle 6"
                                                        Stroke="{DynamicResource SurfaceBorder}"
                                                        StrokeThickness="1"
                                                        Padding="8,10"
                                                        Grid.Column="3">
                                                    <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                                        <Label x:Name="ResourceLevel4Icon" Text="ðŸ”¥" FontSize="16" HorizontalOptions="Center" />
                                                        <Label x:Name="ResourceLevel4Label" Text="Maximum" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" HorizontalOptions="Center" />
                                                        <Label x:Name="ResourceLevel4Percent" Text="100%" FontSize="9" TextColor="{DynamicResource TextMuted}" HorizontalOptions="Center" />
                                                    </VerticalStackLayout>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer Tapped="OnResourceLevel4Clicked" />
                                                        <PointerGestureRecognizer PointerEntered="OnResourceLevelHoverEnter" PointerExited="OnResourceLevelHoverExit" />
                                                    </Border.GestureRecognizers>
                                                </Border>
                                            </Grid>
                                            
                                            <!-- Thread count indicator -->
                                            <HorizontalStackLayout HorizontalOptions="Center" Spacing="4">
                                                <Label x:Name="ThreadCountLabel" Text="Using 4 of 8 threads" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                            </HorizontalStackLayout>
                                        </VerticalStackLayout>
                                    </Border>
                                </VerticalStackLayout>

                                <!-- STORAGE SECTION -->
                                <HorizontalStackLayout Spacing="6" Margin="0,6,0,0">
                                    <Label Text="ðŸ“" FontSize="12" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                    <Label x:Name="StorageLocationsLabel" Text="Storage Locations" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextTertiary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>

                                <!-- Storage locations grouped container -->
                                <Border BackgroundColor="{DynamicResource BackgroundSecondary}" StrokeShape="RoundRectangle 8" Stroke="{DynamicResource SurfaceBorderSubtle}" StrokeThickness="1" Padding="12,10">
                                    <VerticalStackLayout Spacing="12">
                                        <!-- Model Storage Directory -->
                                        <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto,Auto">
                                            <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                                <Label x:Name="ModelDirTitle" Text="Model Directory" FontSize="12" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                                <Label x:Name="ModelDirDescription" Text="Where AI models are stored" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                            </VerticalStackLayout>
                                            <Border x:Name="OpenModelDirButton" Grid.Column="1" BackgroundColor="Transparent" Stroke="{DynamicResource SurfaceBorder}" StrokeShape="RoundRectangle 4" StrokeThickness="1" Padding="8,3" Margin="0,0,4,0" VerticalOptions="Center">
                                                <Label x:Name="OpenModelDirLabel" Text="Open" FontSize="10" TextColor="{DynamicResource TextSecondary}" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnOpenModelDirClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnDirButtonHoverEnter" PointerExited="OnDirButtonHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Border x:Name="BrowseModelDirButton" Grid.Column="2" BackgroundColor="Transparent" Stroke="{DynamicResource SurfaceBorder}" StrokeShape="RoundRectangle 4" StrokeThickness="1" Padding="8,3" VerticalOptions="Center">
                                                <Label x:Name="ChangeModelDirLabel" Text="Change" FontSize="10" TextColor="{DynamicResource TextSecondary}" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnBrowseModelDirClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnDirButtonHoverEnter" PointerExited="OnDirButtonHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Label x:Name="ModelDirLabel" Grid.Row="1" Grid.ColumnSpan="3" FontSize="9" TextColor="{DynamicResource TextMuted}" LineBreakMode="TailTruncation" Margin="0,2,0,0" />
                                        </Grid>

                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />

                                        <!-- Recordings Directory -->
                                        <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto,Auto">
                                            <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                                <Label x:Name="RecordingsDirTitle" Text="Recordings Directory" FontSize="12" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                                <Label x:Name="RecordingsDirDescription" Text="Where audio recordings are saved" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                            </VerticalStackLayout>
                                            <Border x:Name="OpenRecordingsDirButton" Grid.Column="1" BackgroundColor="Transparent" Stroke="{DynamicResource SurfaceBorder}" StrokeShape="RoundRectangle 4" StrokeThickness="1" Padding="8,3" Margin="0,0,4,0" VerticalOptions="Center">
                                                <Label x:Name="OpenRecordingsDirLabel" Text="Open" FontSize="10" TextColor="{DynamicResource TextSecondary}" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnOpenRecordingsDirClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnDirButtonHoverEnter" PointerExited="OnDirButtonHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Border x:Name="BrowseRecordingsDirButton" Grid.Column="2" BackgroundColor="Transparent" Stroke="{DynamicResource SurfaceBorder}" StrokeShape="RoundRectangle 4" StrokeThickness="1" Padding="8,3" VerticalOptions="Center">
                                                <Label x:Name="ChangeRecordingsDirLabel" Text="Change" FontSize="10" TextColor="{DynamicResource TextSecondary}" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnBrowseRecordingsDirClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnDirButtonHoverEnter" PointerExited="OnDirButtonHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Label x:Name="RecordingsDirLabel" Grid.Row="1" Grid.ColumnSpan="3" FontSize="9" TextColor="{DynamicResource TextMuted}" LineBreakMode="TailTruncation" Margin="0,2,0,0" />
                                        </Grid>

                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />

                                        <!-- History Directory -->
                                        <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto,Auto">
                                            <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                                <Label x:Name="HistoryDirTitle" Text="History Directory" FontSize="12" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                                <Label x:Name="HistoryDirDescription" Text="Where transcription history is stored" FontSize="10" TextColor="{DynamicResource TextTertiary}" />
                                            </VerticalStackLayout>
                                            <Border x:Name="OpenHistoryDirButton" Grid.Column="1" BackgroundColor="Transparent" Stroke="{DynamicResource SurfaceBorder}" StrokeShape="RoundRectangle 4" StrokeThickness="1" Padding="8,3" Margin="0,0,4,0" VerticalOptions="Center">
                                                <Label x:Name="OpenHistoryDirLabel" Text="Open" FontSize="10" TextColor="{DynamicResource TextSecondary}" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnOpenHistoryDirClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnDirButtonHoverEnter" PointerExited="OnDirButtonHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Border x:Name="BrowseHistoryDirButton" Grid.Column="2" BackgroundColor="Transparent" Stroke="{DynamicResource SurfaceBorder}" StrokeShape="RoundRectangle 4" StrokeThickness="1" Padding="8,3" VerticalOptions="Center">
                                                <Label x:Name="ChangeHistoryDirLabel" Text="Change" FontSize="10" TextColor="{DynamicResource TextSecondary}" />
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnBrowseHistoryDirClicked" />
                                                    <PointerGestureRecognizer PointerEntered="OnDirButtonHoverEnter" PointerExited="OnDirButtonHoverExit" />
                                                </Border.GestureRecognizers>
                                            </Border>
                                            <Label x:Name="HistoryDirLabel" Grid.Row="1" Grid.ColumnSpan="3" FontSize="9" TextColor="{DynamicResource TextMuted}" LineBreakMode="TailTruncation" Margin="0,2,0,0" />
                                        </Grid>
                                    </VerticalStackLayout>
                                </Border>
                            </VerticalStackLayout>
                        </ScrollView>
                    </Border>

                    <!-- Footer (fixed) -->
                    <VerticalStackLayout Grid.Row="2" Spacing="16" Padding="24,20,24,24">
                        <!-- Reset Link -->
                        <HorizontalStackLayout HorizontalOptions="Center" Spacing="6">
                            <Label x:Name="ResetButtonLabel" 
                                   Text="â†º Reset to Defaults" 
                                   FontSize="12" 
                                   TextColor="{DynamicResource TextMuted}" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnResetSettingsClicked" />
                                    <PointerGestureRecognizer PointerEntered="OnResetHoverEnter" PointerExited="OnResetHoverExit" />
                                </Label.GestureRecognizers>
                            </Label>
                        </HorizontalStackLayout>
                        
                        <!-- Divider -->
                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorder}" HorizontalOptions="Fill" Opacity="0.5" />

                        <!-- Version and Esc hint -->
                        <HorizontalStackLayout HorizontalOptions="Center" Spacing="16">
                            <Label x:Name="VersionLabel" 
                                   Text="v2026.1.2" 
                                   FontSize="11" 
                                   TextColor="{DynamicResource TextMuted}" 
                                   VerticalOptions="Center" />
                            <Label Text="Â·" 
                                   FontSize="11" 
                                   TextColor="{DynamicResource TextMuted}" 
                                   VerticalOptions="Center" />
                            <Label x:Name="EscHintLabel" 
                                   Text="Esc to close" 
                                   FontSize="11" 
                                   TextColor="{DynamicResource TextMuted}" 
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                    
                    <!-- Hidden Reset Button for compatibility -->
                    <Border x:Name="ResetButton" IsVisible="False" />

                    <!-- Language Dropdown Menu (Overlay) -->
                    <Border x:Name="LanguageDropdownMenu"
                            Grid.RowSpan="3"
                            IsVisible="False"
                            BackgroundColor="{DynamicResource SurfaceColor}"
                            StrokeShape="RoundRectangle 6"
                            Stroke="{DynamicResource SurfaceBorder}"
                            StrokeThickness="1"
                            Padding="4"
                            Margin="0,95,24,0"
                            HorizontalOptions="End"
                            VerticalOptions="Start"
                            ZIndex="200">
                        <Border.Shadow>
                            <Shadow Brush="#000000" Offset="0,4" Radius="8" Opacity="0.3" />
                        </Border.Shadow>
                        <VerticalStackLayout Spacing="2">
                            <!-- English Option -->
                            <Border x:Name="EnglishOption" BackgroundColor="Transparent" StrokeShape="RoundRectangle 4" Stroke="Transparent" Padding="10,8">
                                <HorizontalStackLayout Spacing="10">
                                    <!-- UK Flag -->
                                    <Grid WidthRequest="24" HeightRequest="16" VerticalOptions="Center">
                                        <BoxView Color="#012169" CornerRadius="2" />
                                        <BoxView Color="White" WidthRequest="5" HorizontalOptions="Center" />
                                        <BoxView Color="White" HeightRequest="4" VerticalOptions="Center" />
                                        <BoxView Color="#C8102E" WidthRequest="2.5" HorizontalOptions="Center" />
                                        <BoxView Color="#C8102E" HeightRequest="2" VerticalOptions="Center" />
                                    </Grid>
                                    <Label Text="English" FontSize="13" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnEnglishSelected" />
                                    <PointerGestureRecognizer PointerEntered="OnLanguageOptionHoverEnter" PointerExited="OnLanguageOptionHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>
                            <!-- French Option -->
                            <Border x:Name="FrenchOption" BackgroundColor="Transparent" StrokeShape="RoundRectangle 4" Stroke="Transparent" Padding="10,8">
                                <HorizontalStackLayout Spacing="10">
                                    <!-- French Flag -->
                                    <Grid WidthRequest="24" HeightRequest="16" VerticalOptions="Center" ColumnDefinitions="*,*,*">
                                        <BoxView Color="#002395" CornerRadius="2,0,0,2" />
                                        <BoxView Grid.Column="1" Color="White" />
                                        <BoxView Grid.Column="2" Color="#ED2939" CornerRadius="0,2,2,0" />
                                    </Grid>
                                    <Label Text="FranÃ§ais" FontSize="13" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnFrenchSelected" />
                                    <PointerGestureRecognizer PointerEntered="OnLanguageOptionHoverEnter" PointerExited="OnLanguageOptionHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>
                        </VerticalStackLayout>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Grid Grid.Row="2" RowDefinitions="1,Auto">
            <BoxView BackgroundColor="{DynamicResource SurfaceBorder}" HeightRequest="1" />
            <Grid Grid.Row="1" 
                  BackgroundColor="{DynamicResource BackgroundSecondary}"
                  Padding="12,5"
                  ColumnDefinitions="Auto,Auto,Auto,*,Auto">
                
                <!-- Theme Toggle -->
                <Border x:Name="ThemeToggle"
                        BackgroundColor="Transparent"
                        StrokeShape="RoundRectangle 4"
                        Stroke="Transparent"
                        StrokeThickness="0"
                        HeightRequest="22"
                        WidthRequest="22"
                        Padding="0"
                        Margin="0,0,8,0"
                        VerticalOptions="Center">
                    <Label x:Name="ThemeToggleIcon"
                           Text="ðŸŒ™"
                           FontSize="12"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnThemeToggleClicked" />
                        <PointerGestureRecognizer PointerEntered="OnThemeToggleHoverEnter" PointerExited="OnThemeToggleHoverExit" />
                    </Border.GestureRecognizers>
                </Border>
                
                <!-- Product Name -->
                <HorizontalStackLayout Grid.Column="1" Spacing="6" VerticalOptions="Center">
                    <Label x:Name="FooterAppNameLabel"
                           Text="LynxTranscribe" 
                           FontSize="11" 
                           FontAttributes="Bold"
                           TextColor="{DynamicResource TextSecondary}" 
                           VerticalOptions="Center" />
                    <Label x:Name="FooterVersionLabel"
                           Text="v2026.1.2" 
                           FontSize="10" 
                           TextColor="{DynamicResource TextTertiary}" 
                           VerticalOptions="Center" />
                    <BoxView WidthRequest="1" HeightRequest="12" BackgroundColor="{DynamicResource SurfaceBorder}" VerticalOptions="Center" Margin="4,0" />
                </HorizontalStackLayout>
                
                <!-- Powered by LM-Kit -->
                <HorizontalStackLayout Grid.Column="2" Spacing="6" VerticalOptions="Center">
                    <Label Text="Powered by" 
                           FontSize="10" 
                           TextColor="{DynamicResource TextTertiary}" 
                           VerticalOptions="Center" />
                    <Image Source="lmkitlogo.png" 
                           HeightRequest="16" 
                           WidthRequest="16" 
                           VerticalOptions="Center" 
                           Aspect="AspectFit" />
                    <Label Text="LM-Kit" 
                           FontSize="10" 
                           FontAttributes="Bold" 
                           TextColor="{DynamicResource TextSecondary}" 
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
                
                <!-- Right side: Status indicators -->
                <HorizontalStackLayout Grid.Column="4" Spacing="16" VerticalOptions="Center">
                    <!-- VAD Status -->
                    <HorizontalStackLayout x:Name="VadStatusContainer" Spacing="5" VerticalOptions="Center" ToolTipProperties.Text="Voice Activity Detection - Filters out silence and non-speech audio">
                        <Label x:Name="VadStatusLabelPrefix" Text="VAD:" 
                               FontSize="10" 
                               TextColor="{DynamicResource TextTertiary}" 
                               VerticalOptions="Center" />
                        <Border x:Name="VadStatusBadge"
                                BackgroundColor="{DynamicResource SuccessSurface}"
                                StrokeShape="RoundRectangle 3"
                                StrokeThickness="0"
                                Padding="6,2"
                                HeightRequest="18"
                                VerticalOptions="Center">
                            <Label x:Name="VadStatusLabel" 
                                   Text="ON" 
                                   FontSize="9" 
                                   FontAttributes="Bold"
                                   TextColor="#22c55e" 
                                   VerticalOptions="Center"
                                   VerticalTextAlignment="Center" />
                        </Border>
                    </HorizontalStackLayout>
                    
                    <!-- Audio Input -->
                    <HorizontalStackLayout Spacing="5" VerticalOptions="Center">
                        <Label Text="ðŸŽ¤" 
                               FontSize="11" 
                               TextColor="{DynamicResource TextTertiary}" 
                               VerticalOptions="Center" />
                        <Label x:Name="AudioInputStatusLabel" 
                               Text="Default" 
                               FontSize="10" 
                               TextColor="{DynamicResource TextSecondary}" 
                               VerticalOptions="Center"
                               WidthRequest="180"
                               LineBreakMode="TailTruncation" />
                    </HorizontalStackLayout>
                    
                    <!-- Backend -->
                    <HorizontalStackLayout Spacing="5" VerticalOptions="Center">
                        <Label Text="Backend:" 
                               FontSize="10" 
                               TextColor="{DynamicResource TextTertiary}" 
                               VerticalOptions="Center" />
                        <Border BackgroundColor="{DynamicResource BackgroundTertiary}"
                                StrokeShape="RoundRectangle 3"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeThickness="1"
                                Padding="6,2"
                                HeightRequest="18"
                                VerticalOptions="Center">
                            <Label x:Name="BackendLabel" 
                                   Text="..." 
                                   FontSize="9" 
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource TextSecondary}" 
                                   VerticalOptions="Center"
                                   VerticalTextAlignment="Center" />
                        </Border>
                    </HorizontalStackLayout>
                </HorizontalStackLayout>
            </Grid>
        </Grid>

        <!-- Toast Notification Container -->
        <Border x:Name="ToastContainer"
                Grid.Row="1"
                Grid.RowSpan="2"
                BackgroundColor="{DynamicResource SurfaceColor}"
                StrokeShape="RoundRectangle 20"
                Stroke="Transparent"
                StrokeThickness="0"
                Padding="20,14"
                Margin="0,0,26,14"
                HorizontalOptions="End"
                VerticalOptions="End"
                IsVisible="False"
                Opacity="0"
                MaximumWidthRequest="400">
            <Border.Shadow>
                <Shadow Brush="#000000"
                        Offset="0,4"
                        Radius="16"
                        Opacity="0.25" />
            </Border.Shadow>
            <HorizontalStackLayout Spacing="12">
                <Label x:Name="ToastIcon"
                       Text="âœ“"
                       FontSize="16"
                       TextColor="{DynamicResource AccentPrimary}"
                       VerticalOptions="Center" />
                <Label x:Name="ToastMessage"
                       Text=""
                       FontSize="14"
                       FontAttributes="None"
                       TextColor="{DynamicResource TextPrimary}"
                       VerticalOptions="Center"
                       MaxLines="2"
                       LineBreakMode="TailTruncation" />
            </HorizontalStackLayout>
        </Border>

        <!-- Export Panel Overlay -->
        <Grid x:Name="ExportPanelOverlay" 
              Grid.RowSpan="3"
              BackgroundColor="#80000000"
              IsVisible="False"
              ZIndex="2000">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnExportPanelCancel" />
            </Grid.GestureRecognizers>
            
            <Border BackgroundColor="{DynamicResource SurfaceColor}"
                    StrokeShape="RoundRectangle 16"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    Padding="24"
                    WidthRequest="380"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                <Border.Shadow>
                    <Shadow Brush="#000000" Offset="0,8" Radius="24" Opacity="0.4" />
                </Border.Shadow>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer />
                </Border.GestureRecognizers>
                <VerticalStackLayout Spacing="20">
                    <!-- Header -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Label x:Name="ExportTranscriptTitle"
                               Text="Export Transcript"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource TextPrimary}"
                               VerticalOptions="Center" />
                        <Border x:Name="ExportPanelCloseButton"
                                Grid.Column="1"
                                BackgroundColor="Transparent"
                                StrokeShape="RoundRectangle 6"
                                Stroke="Transparent"
                                WidthRequest="32"
                                HeightRequest="32"
                                HorizontalOptions="Center"
                                VerticalOptions="Center">
                            <Label Text="âœ•" 
                                   FontSize="16" 
                                   TextColor="{DynamicResource TextMuted}" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center" />
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnExportPanelCancel" />
                                <PointerGestureRecognizer PointerEntered="OnExportCloseHoverEnter" PointerExited="OnExportCloseHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                    </Grid>
                    
                    <!-- Format Options -->
                    <VerticalStackLayout Spacing="10">
                        <!-- Text File -->
                        <Border x:Name="ExportOptionTxt"
                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                StrokeShape="RoundRectangle 10"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeThickness="1"
                                Padding="14,12">
                            <Grid ColumnDefinitions="48,*,Auto" ColumnSpacing="12">
                                <Border BackgroundColor="#1a3b82f6"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="Transparent"
                                        WidthRequest="44"
                                        HeightRequest="44">
                                    <Label Text="ðŸ“„" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
                                </Border>
                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                    <Label x:Name="PlainTextLabel" Text="Plain Text" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                    <Label x:Name="PlainTextDescLabel" Text=".txt - Simple text format" FontSize="11" TextColor="{DynamicResource TextTertiary}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnExportTxtClicked" />
                                <PointerGestureRecognizer PointerEntered="OnExportOptionHoverEnter" PointerExited="OnExportOptionHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>

                        <!-- Word Document -->
                        <Border x:Name="ExportOptionDocx"
                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                StrokeShape="RoundRectangle 10"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeThickness="1"
                                Padding="14,12">
                            <Grid ColumnDefinitions="48,*,Auto" ColumnSpacing="12">
                                <Border BackgroundColor="#1a2563eb"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="Transparent"
                                        WidthRequest="44"
                                        HeightRequest="44">
                                    <Label Text="ðŸ“˜" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
                                </Border>
                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                    <Label x:Name="WordDocLabel" Text="Word Document" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                    <Label x:Name="WordDocDescLabel" Text=".docx - Microsoft Word format" FontSize="11" TextColor="{DynamicResource TextTertiary}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnExportDocxClicked" />
                                <PointerGestureRecognizer PointerEntered="OnExportOptionHoverEnter" PointerExited="OnExportOptionHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>

                        <!-- Rich Text -->
                        <Border x:Name="ExportOptionRtf"
                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                StrokeShape="RoundRectangle 10"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeThickness="1"
                                Padding="14,12">
                            <Grid ColumnDefinitions="48,*,Auto" ColumnSpacing="12">
                                <Border BackgroundColor="#1a8b5cf6"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="Transparent"
                                        WidthRequest="44"
                                        HeightRequest="44">
                                    <Label Text="ðŸ“" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
                                </Border>
                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                    <Label x:Name="RichTextLabel" Text="Rich Text" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                    <Label x:Name="RichTextDescLabel" Text=".rtf - Formatted text with styling" FontSize="11" TextColor="{DynamicResource TextTertiary}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnExportRtfClicked" />
                                <PointerGestureRecognizer PointerEntered="OnExportOptionHoverEnter" PointerExited="OnExportOptionHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>

                        <!-- SRT Subtitles -->
                        <Border x:Name="ExportOptionSrt"
                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                StrokeShape="RoundRectangle 10"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeThickness="1"
                                Padding="14,12">
                            <Grid ColumnDefinitions="48,*,Auto" ColumnSpacing="12">
                                <Border BackgroundColor="#1af59e0b"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="Transparent"
                                        WidthRequest="44"
                                        HeightRequest="44">
                                    <Label Text="ðŸŽ¬" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
                                </Border>
                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                    <Label x:Name="SrtLabel" Text="SRT Subtitles" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                    <Label x:Name="SrtDescLabel" Text=".srt - Timed subtitles for video" FontSize="11" TextColor="{DynamicResource TextTertiary}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnExportSrtClicked" />
                                <PointerGestureRecognizer PointerEntered="OnExportOptionHoverEnter" PointerExited="OnExportOptionHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>

                        <!-- VTT Subtitles -->
                        <Border x:Name="ExportOptionVtt"
                                BackgroundColor="{DynamicResource BackgroundTertiary}"
                                StrokeShape="RoundRectangle 10"
                                Stroke="{DynamicResource SurfaceBorder}"
                                StrokeThickness="1"
                                Padding="14,12">
                            <Grid ColumnDefinitions="48,*,Auto" ColumnSpacing="12">
                                <Border BackgroundColor="#1a22c55e"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="Transparent"
                                        WidthRequest="44"
                                        HeightRequest="44">
                                    <Label Text="ðŸŽž" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
                                </Border>
                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                    <Label x:Name="VttLabel" Text="WebVTT Subtitles" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                    <Label x:Name="VttDescLabel" Text=".vtt - Web video text tracks" FontSize="11" TextColor="{DynamicResource TextTertiary}" />
                                </VerticalStackLayout>
                                <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                            </Grid>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnExportVttClicked" />
                                <PointerGestureRecognizer PointerEntered="OnExportOptionHoverEnter" PointerExited="OnExportOptionHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Options Section -->
                    <Border BackgroundColor="{DynamicResource BackgroundTertiary}"
                            StrokeShape="RoundRectangle 10"
                            Stroke="{DynamicResource SurfaceBorder}"
                            StrokeThickness="1"
                            Padding="4"
                            Margin="0,4,0,0">
                        <VerticalStackLayout Spacing="0">
                            <!-- Auto-open toggle -->
                            <Border x:Name="ExportAutoOpenRow"
                                    BackgroundColor="Transparent"
                                    StrokeShape="RoundRectangle 8"
                                    Stroke="Transparent"
                                    Padding="12,10">
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label x:Name="OpenFileAfterExportLabel"
                                           Text="Open file after export"
                                           FontSize="13"
                                           TextColor="{DynamicResource TextPrimary}"
                                           VerticalOptions="Center" />
                                    <!-- Toggle switch style -->
                                    <Border x:Name="ExportAutoOpenBox"
                                            Grid.Column="1"
                                            WidthRequest="40"
                                            HeightRequest="22"
                                            BackgroundColor="{DynamicResource AccentPrimary}"
                                            StrokeShape="RoundRectangle 11"
                                            Stroke="Transparent"
                                            VerticalOptions="Center">
                                        <Border x:Name="ExportAutoOpenKnob"
                                                WidthRequest="18"
                                                HeightRequest="18"
                                                BackgroundColor="White"
                                                StrokeShape="RoundRectangle 9"
                                                Stroke="Transparent"
                                                HorizontalOptions="End"
                                                VerticalOptions="Center"
                                                Margin="2">
                                            <Label x:Name="ExportAutoOpenCheck" IsVisible="False" />
                                        </Border>
                                    </Border>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnExportAutoOpenToggle" />
                                    <PointerGestureRecognizer PointerEntered="OnExportAutoOpenHoverEnter" PointerExited="OnExportAutoOpenHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Separator -->
                            <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorder}" Margin="12,0" Opacity="0.5" />

                            <!-- Dictation formatting toggle -->
                            <Border x:Name="ExportDictationRow"
                                    BackgroundColor="Transparent"
                                    StrokeShape="RoundRectangle 8"
                                    Stroke="Transparent"
                                    Padding="12,10">
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label x:Name="ExportDictationLabel"
                                           Text="Apply dictation formatting"
                                           FontSize="13"
                                           TextColor="{DynamicResource TextPrimary}"
                                           VerticalOptions="Center" />
                                    <!-- Toggle switch style -->
                                    <Border x:Name="ExportDictationBox"
                                            Grid.Column="1"
                                            WidthRequest="40"
                                            HeightRequest="22"
                                            BackgroundColor="{DynamicResource AccentPrimary}"
                                            StrokeShape="RoundRectangle 11"
                                            Stroke="Transparent"
                                            VerticalOptions="Center">
                                        <Border x:Name="ExportDictationKnob"
                                                WidthRequest="18"
                                                HeightRequest="18"
                                                BackgroundColor="White"
                                                StrokeShape="RoundRectangle 9"
                                                Stroke="Transparent"
                                                HorizontalOptions="End"
                                                VerticalOptions="Center"
                                                Margin="2">
                                            <Label x:Name="ExportDictationCheck" IsVisible="False" />
                                        </Border>
                                    </Border>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnExportDictationToggle" />
                                    <PointerGestureRecognizer PointerEntered="OnExportDictationHoverEnter" PointerExited="OnExportDictationHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </Border>
        </Grid>

        <!-- Error Dialog Overlay -->
        <Grid x:Name="ErrorDialogOverlay" 
              Grid.RowSpan="3"
              BackgroundColor="#80000000"
              IsVisible="False"
              ZIndex="2000">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnErrorDialogDismiss" />
            </Grid.GestureRecognizers>
            
            <Border BackgroundColor="{DynamicResource SurfaceColor}"
                    StrokeShape="RoundRectangle 16"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    Padding="24"
                    WidthRequest="420"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                <Border.Shadow>
                    <Shadow Brush="#000000" Offset="0,8" Radius="24" Opacity="0.4" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <!-- Header with icon -->
                    <HorizontalStackLayout Spacing="12">
                        <Border BackgroundColor="#2a1a1a" 
                                StrokeShape="RoundRectangle 8" 
                                Stroke="Transparent" 
                                WidthRequest="40" 
                                HeightRequest="40"
                                HorizontalOptions="Center"
                                VerticalOptions="Center">
                            <Label Text="âš " 
                                   FontSize="20" 
                                   TextColor="#ef4444" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center" />
                        </Border>
                        <Label x:Name="ErrorDialogTitle"
                               Text="Error"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource TextPrimary}"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>
                    
                    <!-- Error message -->
                    <Label x:Name="ErrorDialogMessage"
                           Text=""
                           FontSize="14"
                           TextColor="{DynamicResource TextSecondary}"
                           LineBreakMode="WordWrap"
                           MaxLines="6" />
                    
                    <!-- OK Button -->
                    <Border x:Name="ErrorDialogOkButton"
                            BackgroundColor="{DynamicResource AccentPrimary}"
                            StrokeShape="RoundRectangle 8"
                            Stroke="Transparent"
                            Padding="16,10"
                            HorizontalOptions="End"
                            Margin="0,8,0,0">
                        <Label Text="OK"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="White"
                               HorizontalOptions="Center" />
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnErrorDialogDismiss" />
                        </Border.GestureRecognizers>
                    </Border>
                </VerticalStackLayout>
            </Border>
        </Grid>

        <!-- Custom Segment Tooltip -->
        <Border x:Name="SegmentTooltip"
                Grid.Row="0"
                Grid.RowSpan="3"
                BackgroundColor="{DynamicResource SurfaceColor}"
                StrokeShape="RoundRectangle 12"
                Stroke="{DynamicResource SurfaceBorder}"
                StrokeThickness="1"
                Padding="14,10"
                HorizontalOptions="Start"
                VerticalOptions="Start"
                IsVisible="False"
                InputTransparent="True"
                ZIndex="1000">
            <Border.Shadow>
                <Shadow Brush="#000000"
                        Offset="0,4"
                        Radius="12"
                        Opacity="0.3" />
            </Border.Shadow>
            <VerticalStackLayout Spacing="6">
                <!-- Time Range -->
                <HorizontalStackLayout Spacing="6">
                    <Label Text="â±" FontSize="12" TextColor="{DynamicResource AccentPrimary}" VerticalOptions="Center" />
                    <Label x:Name="TooltipTimeRange" Text="0:05 â†’ 0:06" FontSize="12" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                </HorizontalStackLayout>
                
                <!-- Stats Row - simplified to HorizontalStackLayout -->
                <HorizontalStackLayout Spacing="8">
                    <!-- Duration -->
                    <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="Transparent" Padding="8,4">
                        <VerticalStackLayout Spacing="1">
                            <Label x:Name="TooltipDurationLabel" Text="Duration" FontSize="9" TextColor="{DynamicResource TextMuted}" />
                            <Label x:Name="TooltipDuration" Text="1.4s" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                        </VerticalStackLayout>
                    </Border>
                    
                    <!-- Language -->
                    <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="Transparent" Padding="8,4">
                        <VerticalStackLayout Spacing="1">
                            <Label x:Name="TooltipLanguageLabel" Text="Language" FontSize="9" TextColor="{DynamicResource TextMuted}" />
                            <Label x:Name="TooltipLanguage" Text="EN" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                        </VerticalStackLayout>
                    </Border>
                    
                    <!-- Confidence -->
                    <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="Transparent" Padding="8,4">
                        <VerticalStackLayout Spacing="1">
                            <Label x:Name="TooltipConfidenceLabel" Text="Confidence" FontSize="9" TextColor="{DynamicResource TextMuted}" />
                            <HorizontalStackLayout Spacing="4">
                                <Label x:Name="TooltipConfidence" Text="75%" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                                <Label x:Name="TooltipConfidenceIcon" Text="â—" FontSize="8" TextColor="#22c55e" VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>

        <!-- Download Blocking Overlay - covers entire UI except its own cancel button -->
        <Grid x:Name="DownloadBlockingOverlay" 
              Grid.Row="0"
              Grid.RowSpan="3" 
              BackgroundColor="#80000000"
              IsVisible="False"
              InputTransparent="False"
              ZIndex="999">
            
            <!-- Download progress centered on screen -->
            <Border BackgroundColor="{DynamicResource BackgroundSecondary}"
                    StrokeShape="RoundRectangle 16"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    Padding="32,24"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    WidthRequest="300">
                <VerticalStackLayout Spacing="16" HorizontalOptions="Center">
                    <ActivityIndicator IsRunning="True" 
                                       Color="{DynamicResource AccentPrimary}"
                                       HeightRequest="40"
                                       WidthRequest="40" />
                    <Label x:Name="OverlayDownloadLabel"
                           Text="Downloading model..."
                           FontSize="15"
                           FontAttributes="Bold"
                           TextColor="{DynamicResource TextPrimary}"
                           HorizontalOptions="Center" />
                    <Label x:Name="OverlayDownloadDetail"
                           Text=""
                           FontSize="13"
                           TextColor="{DynamicResource TextSecondary}"
                           HorizontalOptions="Center" />
                    
                    <!-- Cancel button -->
                    <Border BackgroundColor="{DynamicResource DangerColor}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 8"
                            StrokeThickness="0"
                            HeightRequest="40"
                            Padding="24,0"
                            Margin="0,8,0,0"
                            HorizontalOptions="Center">
                        <HorizontalStackLayout Spacing="8" VerticalOptions="Center" HorizontalOptions="Center">
                            <Label Text="âœ•" FontSize="12" TextColor="White" VerticalOptions="Center" />
                            <Label x:Name="OverlayCancelText" Text="Cancel" FontSize="14" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" />
                        </HorizontalStackLayout>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnCancelTranscriptionClicked" />
                        </Border.GestureRecognizers>
                    </Border>
                </VerticalStackLayout>
            </Border>
        </Grid>

        <!-- Dictation Commands Help Overlay -->
        <Grid x:Name="DictationHelpOverlay" 
              Grid.RowSpan="3"
              IsVisible="False"
              BackgroundColor="#80000000"
              ZIndex="200">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnDictationHelpOverlayClicked" />
            </Grid.GestureRecognizers>
            
            <Border BackgroundColor="{DynamicResource BackgroundPrimary}"
                    StrokeShape="RoundRectangle 12"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    WidthRequest="420"
                    MaximumHeightRequest="550"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    Padding="0">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer />
                </Border.GestureRecognizers>
                
                <Grid RowDefinitions="Auto,*">
                    <!-- Header -->
                    <Grid Padding="24,20,24,16" ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Spacing="4">
                            <Label x:Name="DictationHelpTitle" Text="Dictation Commands" FontSize="18" FontAttributes="Bold" TextColor="{DynamicResource TextPrimary}" />
                            <Label x:Name="DictationHelpSubtitle" Text="Say these words to insert formatting" FontSize="12" TextColor="{DynamicResource TextTertiary}" />
                        </VerticalStackLayout>
                        <Border x:Name="DictationHelpCloseButton" Grid.Column="1" BackgroundColor="Transparent" StrokeShape="RoundRectangle 4" Stroke="Transparent" Padding="8,4" VerticalOptions="Start" Margin="0,-4,-4,0">
                            <Label Text="âœ•" FontSize="16" TextColor="{DynamicResource TextTertiary}" />
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnDictationHelpCloseClicked" />
                                <PointerGestureRecognizer PointerEntered="OnDictationHelpCloseHoverEnter" PointerExited="OnDictationHelpCloseHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                    </Grid>
                    
                    <!-- Commands List -->
                    <ScrollView Grid.Row="1" VerticalScrollBarVisibility="Default" Padding="0">
                        <VerticalStackLayout x:Name="DictationCommandsList" Spacing="0" Padding="24,16,24,24" />
                    </ScrollView>
                </Grid>
            </Border>
        </Grid>

        <!-- Language Selection Overlay -->
        <Grid x:Name="LanguageSelectionOverlay" 
              Grid.RowSpan="3"
              BackgroundColor="#40000000"
              IsVisible="False">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnLanguageSelectionOverlayClicked" />
            </Grid.GestureRecognizers>
            
            <Border x:Name="LanguageSelectionPopup"
                    BackgroundColor="{DynamicResource BackgroundSecondary}"
                    StrokeShape="RoundRectangle 8"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    Padding="0"
                    WidthRequest="220"
                    HeightRequest="320"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                <Border.Shadow>
                    <Shadow Brush="Black" Offset="0,4" Radius="12" Opacity="0.3" />
                </Border.Shadow>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer />
                </Border.GestureRecognizers>
                
                <Grid RowDefinitions="Auto,*">
                    <!-- Header -->
                    <Border Padding="12,10" BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 8,8,0,0" Stroke="Transparent">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label x:Name="LanguageSelectionTitle" 
                                   Text="Select Language" 
                                   FontSize="13" 
                                   FontAttributes="Bold" 
                                   TextColor="{DynamicResource TextPrimary}" 
                                   VerticalOptions="Center" />
                            <Border x:Name="LanguageSelectionCloseButton"
                                    Grid.Column="1"
                                    BackgroundColor="Transparent"
                                    Stroke="Transparent"
                                    StrokeShape="RoundRectangle 4"
                                    Padding="4,2"
                                    VerticalOptions="Center">
                                <Label Text="âœ•" FontSize="12" TextColor="{DynamicResource TextTertiary}" />
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnLanguageSelectionCloseClicked" />
                                    <PointerGestureRecognizer PointerEntered="OnLanguageSelectionCloseHoverEnter" PointerExited="OnLanguageSelectionCloseHoverExit" />
                                </Border.GestureRecognizers>
                            </Border>
                        </Grid>
                    </Border>
                    
                    <!-- Language List -->
                    <ScrollView Grid.Row="1" VerticalScrollBarVisibility="Always">
                        <VerticalStackLayout x:Name="LanguageSelectionList" Spacing="1" Padding="6,6,6,10">
                            <!-- Languages added programmatically -->
                        </VerticalStackLayout>
                    </ScrollView>
                </Grid>
            </Border>
        </Grid>

        <!-- Keyboard Shortcuts Overlay -->
        <Grid x:Name="KeyboardShortcutsOverlay"
              Grid.RowSpan="3"
              BackgroundColor="#80000000"
              IsVisible="False"
              ZIndex="200">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnKeyboardShortcutsOverlayClicked" />
            </Grid.GestureRecognizers>

            <Border BackgroundColor="{DynamicResource BackgroundSecondary}"
                    StrokeShape="RoundRectangle 16"
                    Stroke="{DynamicResource SurfaceBorder}"
                    StrokeThickness="1"
                    Padding="0"
                    WidthRequest="480"
                    MaximumHeightRequest="650"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                <Border.Shadow>
                    <Shadow Brush="#000000" Offset="0,8" Radius="24" Opacity="0.4" />
                </Border.Shadow>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer />
                </Border.GestureRecognizers>

                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- Header -->
                    <Grid ColumnDefinitions="*,Auto" Padding="24,20,24,16">
                        <HorizontalStackLayout Spacing="12">
                            <Border BackgroundColor="{DynamicResource AccentSurface}"
                                    StrokeShape="RoundRectangle 8"
                                    Stroke="{DynamicResource AccentMuted}"
                                    StrokeThickness="1"
                                    WidthRequest="36"
                                    HeightRequest="36">
                                <Label Text="âŒ¨" FontSize="18" TextColor="{DynamicResource AccentText}" HorizontalOptions="Center" VerticalOptions="Center" />
                            </Border>
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center">
                                <Label x:Name="KeyboardShortcutsTitle"
                                       Text="Keyboard Shortcuts"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource TextPrimary}" />
                                <Label x:Name="KeyboardShortcutsDescription"
                                       Text="Quick reference for available shortcuts"
                                       FontSize="11"
                                       TextColor="{DynamicResource TextTertiary}" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                        <Border x:Name="CloseShortcutsButton"
                                Grid.Column="1"
                                BackgroundColor="Transparent"
                                Stroke="Transparent"
                                StrokeShape="RoundRectangle 4"
                                StrokeThickness="1"
                                Padding="6,2"
                                VerticalOptions="Start">
                            <Label Text="âœ•"
                                   FontSize="16"
                                   TextColor="{DynamicResource TextTertiary}"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnCloseShortcutsClicked" />
                                <PointerGestureRecognizer PointerEntered="OnCloseShortcutsHoverEnter" PointerExited="OnCloseShortcutsHoverExit" />
                            </Border.GestureRecognizers>
                        </Border>
                    </Grid>

                    <!-- Shortcuts Content -->
                    <ScrollView Grid.Row="1" Padding="0">
                        <VerticalStackLayout Spacing="16" Padding="24,8,24,24">

                            <!-- General Section -->
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="6">
                                    <Label Text="âš™" FontSize="12" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                    <Label x:Name="ShortcutCategoryGeneralLabel" Text="General" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextTertiary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Border BackgroundColor="{DynamicResource SurfaceColor}" StrokeShape="RoundRectangle 8" Stroke="Transparent" Padding="12,8">
                                    <VerticalStackLayout Spacing="8">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutOpenFileLabel" Text="Open file" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="4">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Ctrl" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="O" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutExportLabel" Text="Export transcript" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="4">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Ctrl" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="S" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutClosePanelLabel" Text="Close panel / dialog" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="Esc" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutShowShortcutsLabel" Text="Show keyboard shortcuts" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="F1" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutStartTranscriptionLabel" Text="Start transcription" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="4">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Ctrl" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="T" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutStartRecordingLabel" Text="Start / Stop recording" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="4">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Ctrl" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="R" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutSwitchTabsLabel" Text="Switch Audio / History tabs" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="Tab" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutNavigateHistoryLabel" Text="Navigate history items" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Spacing="4" Grid.Column="1">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="â†‘" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="â†“" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutClearFileLabel" Text="Clear current file" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="Delete" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                    </VerticalStackLayout>
                                </Border>
                            </VerticalStackLayout>

                            <!-- Playback Section -->
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="6">
                                    <Label Text="â–¶" FontSize="12" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                    <Label x:Name="ShortcutCategoryPlaybackLabel" Text="Playback" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextTertiary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Border BackgroundColor="{DynamicResource SurfaceColor}" StrokeShape="RoundRectangle 8" Stroke="Transparent" Padding="12,8">
                                    <VerticalStackLayout Spacing="8">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutPlayPauseLabel" Text="Play / Pause" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="10,3">
                                                <Label Text="Space" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutSeekBackLabel" Text="Seek backward 5s" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="â†" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutSeekForwardLabel" Text="Seek forward 5s" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="â†’" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutJumpStartLabel" Text="Jump to beginning" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="Home" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutJumpEndLabel" Text="Jump to end" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="End" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutSpeedUpLabel" Text="Increase playback speed" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="]" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutSpeedDownLabel" Text="Decrease playback speed" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                <Label Text="[" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                            </Border>
                                        </Grid>
                                    </VerticalStackLayout>
                                </Border>
                            </VerticalStackLayout>

                            <!-- Transcript Section -->
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="6">
                                    <Label Text="ðŸ“" FontSize="12" TextColor="{DynamicResource AccentText}" VerticalOptions="Center" />
                                    <Label x:Name="ShortcutCategoryTranscriptLabel" Text="Transcript" FontSize="11" FontAttributes="Bold" TextColor="{DynamicResource TextTertiary}" VerticalOptions="Center" />
                                </HorizontalStackLayout>
                                <Border BackgroundColor="{DynamicResource SurfaceColor}" StrokeShape="RoundRectangle 8" Stroke="Transparent" Padding="12,8">
                                    <VerticalStackLayout Spacing="8">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutSearchLabel" Text="Search in transcript" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="4">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Ctrl" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="F" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutNextMatchLabel" Text="Next search match" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="6">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="F3" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="or" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Enter" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutPrevMatchLabel" Text="Previous search match" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="6">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Shift" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="F3" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutCopyTranscriptLabel" Text="Copy transcript to clipboard" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="4">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Ctrl" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Shift" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="C" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{DynamicResource SurfaceBorderSubtle}" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label x:Name="ShortcutToggleViewLabel" Text="Toggle Segments / Document view" FontSize="12" TextColor="{DynamicResource TextPrimary}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="4">
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="Ctrl" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                                <Label Text="+" FontSize="10" TextColor="{DynamicResource TextMuted}" VerticalOptions="Center" />
                                                <Border BackgroundColor="{DynamicResource BackgroundTertiary}" StrokeShape="RoundRectangle 4" Stroke="{DynamicResource SurfaceBorder}" Padding="6,3">
                                                    <Label Text="D" FontSize="10" FontAttributes="Bold" TextColor="{DynamicResource TextSecondary}" />
                                                </Border>
                                            </HorizontalStackLayout>
                                        </Grid>
                                    </VerticalStackLayout>
                                </Border>
                            </VerticalStackLayout>

                        </VerticalStackLayout>
                    </ScrollView>

                    <!-- Footer -->
                    <Border Grid.Row="2" BackgroundColor="{DynamicResource SurfaceColor}" Padding="24,14" StrokeShape="RoundRectangle 0,0,16,16" Stroke="Transparent">
                        <Label x:Name="ShortcutFooterHint"
                               Text="Press Esc or F1 to close"
                               FontSize="11"
                               TextColor="{DynamicResource TextMuted}"
                               HorizontalOptions="Center" />
                    </Border>
                </Grid>
            </Border>
        </Grid>

    </Grid>
</ContentPage>
